{"title":"内网安全-信息收集","uid":"1ebe60b010761b3b7defb8d55e9daafb","slug":"内网安全-信息收集","date":"2024-04-11T11:50:10.000Z","updated":"2024-04-18T03:42:38.865Z","comments":true,"path":"api/articles/内网安全-信息收集.json","keywords":null,"cover":[],"content":"<h2 id=\"内网信息收集\"><a href=\"#内网信息收集\" class=\"headerlink\" title=\"内网信息收集\"></a>内网信息收集</h2><h3 id=\"一-收集本机信息\"><a href=\"#一-收集本机信息\" class=\"headerlink\" title=\"一.收集本机信息\"></a>一.收集本机信息</h3><h4 id=\"判断是否有域\"><a href=\"#判断是否有域\" class=\"headerlink\" title=\"判断是否有域\"></a>判断是否有域</h4><ul>\n<li><p><code>ipconfig /all</code>  在<code>Windows IP 配置</code>项下</p>\n</li>\n<li><p><code>Systeminfo</code> 在”域”词条下, 图中显示为WORKGROUP, 说明没有域<br><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-16%20162703.png?raw=true\"></p>\n</li>\n<li><p><code>net time /domain</code></p>\n<ul>\n<li><p>存在域并且当前用户是域用户<br><img src=\"C:\\Users\\Myprefer\\Desktop\\640.jpg\"></p>\n</li>\n<li><p>存在域，当前用户不是域用户<br>回显:</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">发生系统错误 5</span></span>\n<span class=\"line\"><span style=\"color: #babed8\"></span></span>\n<span class=\"line\"><span style=\"color: #babed8\">拒绝访问</span></span></code></pre></div></li>\n<li><p>不存在域</p>\n<p><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-17%20152845.png?raw=true\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"查看当前登录域\"><a href=\"#查看当前登录域\" class=\"headerlink\" title=\"查看当前登录域\"></a>查看当前登录域</h4><ul>\n<li><p><code>net config workstation</code></p>\n<p><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-17%20153107.png?raw=true\"></p>\n</li>\n</ul>\n<p>​\t\t图中工作站域为workgroup, 则不存在域</p>\n<ul>\n<li><p>ping命令</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> /L %I in</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">1,1,254</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> DO @ping -w 1 -n 1 192.168.110.%I </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">findstr</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">TTL=</span><span style=\"color: #89DDFF\">&quot;</span></span></code></pre></div></li>\n<li><p>使用工具扫描探测</p>\n<ul>\n<li><p><strong>nbtscan</strong> - 一个在本地或远程TCP&#x2F;IP网络上扫描开放的NETBIOS名称服务器的命令行工具</p>\n<ul>\n<li><p><a href=\"https://github.com/resurrecting-open-source-projects/nbtscan\">resurrecting-open-source-projects&#x2F;nbtscan: Scan networks searching for NetBIOS information (github.com)</a></p>\n</li>\n<li><div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">用法:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">nbtscan-unixwiz</span><span style=\"color: #BABED8\"> [选项] 目标 </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">目标...</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">目标可以是IP地址，DNS名称或地址的列表范围。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">范围可以表示成“192.168.12.0/24”或“192.168.12.64-97”</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-V</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">显示版本信息</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-f</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">显示完整的NBT资源记录响应</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">推荐</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-H</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">生成HTTP请求头</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-v</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">开启详细输出调试</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-n</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">不查找响应IP地址的反向名称</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-p</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\">n</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">绑定UDP端口</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">默认0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-m</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">响应中包含MAC地址</span><span style=\"color: #BABED8\"> (等同</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">-f</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-T</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\">n</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">超时不响应</span><span style=\"color: #BABED8\"> (默认2秒)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-w</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\">n</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">次写入后等待秒数</span><span style=\"color: #BABED8\"> (默认10ms)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\">n</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">每个地址尝试次数</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">默认1次</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">-P</span><span style=\"color: #BABED8\">        </span><span style=\"color: #C3E88D\">以perl的hashref格式生成结果</span></span></code></pre></div></li>\n</ul>\n</li>\n<li><p><strong>arp-scan</strong> - ARP扫描工具</p>\n<ul>\n<li>使用: <a href=\"https://blog.csdn.net/newbeixue/article/details/123111543\">arp-scan使用-CSDN博客</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"域内端口扫描\"><a href=\"#域内端口扫描\" class=\"headerlink\" title=\"域内端口扫描\"></a>域内端口扫描</h4><ul>\n<li><p><strong>telnet</strong> 命令扫描</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">telnet</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #C3E88D\">addres</span><span style=\"color: #BABED8\">s</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #C3E88D\">por</span><span style=\"color: #BABED8\">t</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre></div></li>\n<li><p><strong>metasploit</strong> 的端口扫描模块<br><a href=\"https://blog.csdn.net/weixin_44255856/article/details/97900038\">渗透之metasploit技术-端口扫描，漏洞利用_search portscan-CSDN博客</a></p>\n</li>\n<li><p><strong>Nmap</strong></p>\n</li>\n</ul>\n<h4 id=\"查找域控制器\"><a href=\"#查找域控制器\" class=\"headerlink\" title=\"查找域控制器\"></a>查找域控制器</h4><ul>\n<li><code>net group &quot;Domain Controllers&quot; /domain</code></li>\n<li><code>nltest /DCLIST:&lt;域名&gt;</code></li>\n<li><code>nslookup -type=SRV _LDAP._tcp</code></li>\n<li><code>net time /domain</code></li>\n<li><code>netdom query pdc</code></li>\n</ul>\n<h4 id=\"获取域内用户和管理员信息\"><a href=\"#获取域内用户和管理员信息\" class=\"headerlink\" title=\"获取域内用户和管理员信息\"></a>获取域内用户和管理员信息</h4><ul>\n<li><p><strong>查询所有域用户列表</strong>：</p>\n<ul>\n<li><p><code>net user /domain</code></p>\n</li>\n<li><p><code>wmic useraccount get /all</code></p>\n</li>\n<li><p><code>dsquery user</code></p>\n</li>\n<li><p><code>net localgroup administrators /domain</code></p>\n</li>\n</ul>\n</li>\n<li><p><strong>查询域管理员用户组</strong>:</p>\n<ul>\n<li><code>net group &quot;Enterprise Admains&quot; /domain</code></li>\n</ul>\n</li>\n<li><p><strong>定位域管理员</strong>:</p>\n<ul>\n<li><p><strong>PsLoggedon</strong> - <a href=\"https://blog.csdn.net/qq_44159028/article/details/115439633\">定位域管理员_psloggedon-CSDN博客</a><br><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20105737.png?raw=true\"></p>\n</li>\n<li><p><strong>AdFind</strong>- <a href=\"https://blog.csdn.net/weixin_43571641/article/details/124263803\">域内信息查询工具AdFind_adfind download-CSDN博客</a></p>\n</li>\n<li><p><strong>PVEFindADUser</strong> - <a href=\"https://blog.csdn.net/qq_44159028/article/details/115439633\">定位域管理员 PVEFindADUser-CSDN博客</a><br><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20110437.png?raw=true\"></p>\n</li>\n</ul>\n</li>\n<li><p><strong>查找域管理进程</strong>:</p>\n<ul>\n<li><p>本机检查：</p>\n<ul>\n<li><div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">net</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">group</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Domain Admins</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/domain</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//获取域管理员列表</span></span></code></pre></div></li>\n<li><div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">tasklist</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/v</span><span style=\"color: #BABED8\">       </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">列出本机所有进程及进程用户</span></span></code></pre></div><p><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20110732.png?raw=true\"></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong>查询域控制器的域用户会话</strong>：</p>\n<ul>\n<li><p>收集域控制器的列表</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">net</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">group</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Domain Controllers</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/domain</span></span></code></pre></div></li>\n<li><p>收集域管理员列表</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">net</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">group</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Domain Admins</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/domain</span></span></code></pre></div></li>\n<li><p><strong>Netsess</strong><br><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20111100.png?raw=true\"></p>\n</li>\n</ul>\n</li>\n<li><p><strong>扫描远程系统上运行的任务：</strong></p>\n<ul>\n<li><p>前提是目标使用了本地域管理员共享账户</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">FOR</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/F</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%i</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> (ips.txt) DO @echo </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">+</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> %i </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">@tasklist/V</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/S</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%i</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/U</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">user</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/P</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">password</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">2&gt;</span><span style=\"color: #C3E88D\">NUL</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">output.txt</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">FOR</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/F</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">names.txt</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">DO</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">@type</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">output.txt</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">findstr</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">NUL</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">echo</span><span style=\"color: #BABED8\"> [!] %nwas found running a process on %i &amp;&amp; pause</span></span></code></pre></div></li>\n</ul>\n</li>\n<li><p><strong>扫描远程系统上NetBIOS信息</strong>：</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> /F %i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ips.txt</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">@echo</span><span style=\"color: #BABED8\"> [+] Checking %i </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #FFCB6B\">nbtstat</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-A</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%i</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">2&gt;</span><span style=\"color: #C3E88D\">NUL</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #C3E88D\">nbsessions.txt</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">FOR</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/F</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> (admins.txt)DO @type nbsessions.txt </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">findstr</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/I</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">NUL</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">echo</span><span style=\"color: #BABED8\"> [!] %n wasfound logged into %i</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"利用PowerShell收集域内信息\"><a href=\"#利用PowerShell收集域内信息\" class=\"headerlink\" title=\"利用PowerShell收集域内信息\"></a>利用PowerShell收集域内信息</h4><ul>\n<li><p>PowerShell 常用的执行权限共有四种</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">Restricted：默认设置，不允许执行任何脚本。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Allsigned：只能运行经过证书验证的脚本。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Unrestricted：权限最高，可以执行任意脚本。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">RemoteSigned：本地脚本无限制，但是对来自网络的脚本必须经过签名。</span></span></code></pre></div><p>在 PowerShell 中输入“Get-ExecutionPolicy”，可以看到当前权限<br><img src=\"https://github.com/Myprefer/ImageHost/blob/main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20112615.png?raw=true\"></p>\n</li>\n<li><p>使用<strong>PowerSploit</strong>的<strong>PowerView</strong>脚本</p>\n<ul>\n<li><p>导入脚本</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">Import-Module</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">.</span><span style=\"color: #BABED8\">\\P</span><span style=\"color: #C3E88D\">owerView.ps1</span></span></code></pre></div></li>\n<li><p>功能:</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetDomain</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取当前用户所在的域名称。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetUser</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">返回所有用户的详细信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetDomainController</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取所有域控制器。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetComputer</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取所有域内机器的详细信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetOU</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取域中的</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">OU</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetGroup</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取所有域内组和组成员信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetFileServer</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">根据</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">SPN</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取当前域使用的文件服务器。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetShare</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取当前域内所有网络共享。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetSession</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取在指定服务器存在的会话信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetRDPSession</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取在指定服务器存在的远程连接信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetProcess</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取远程主机的进程信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-UserEvent</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取指定用户的日志信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-ADObject</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取活动目录的对象信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-NetGPO</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取域所有组策略对象。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Get-DomainPolicy</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">获取域默认或域控制器策略。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Invoke-UserHunter</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">用于获取域用户登录计算机及该用户是否有本地管理权限。</span></span></code></pre></div></li>\n</ul>\n</li>\n</ul>\n","feature":true,"text":"内网信息收集一.收集本机信息判断是否有域 ipconfig /all 在Windows IP 配置项下 Systeminfo 在”域”词条下, 图中显示为WOR...","permalink":"/post/内网安全-信息收集","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">内网信息收集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%80-%E6%94%B6%E9%9B%86%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">一.收集本机信息</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E5%9F%9F\"><span class=\"toc-text\">判断是否有域</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E5%9F%9F\"><span class=\"toc-text\">查看当前登录域</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%9F%E5%86%85%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">域内端口扫描</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E6%89%BE%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8\"><span class=\"toc-text\">查找域控制器</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%86%85%E7%94%A8%E6%88%B7%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">获取域内用户和管理员信息</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8PowerShell%E6%94%B6%E9%9B%86%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">利用PowerShell收集域内信息</span></a></li></ol></li></ol></li></ol>","author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"An ordinary learner","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"内网安全-权限获取","uid":"4e0d106c449deb12eefa742c671db5c2","slug":"内网安全-权限获取","date":"2024-04-18T03:44:47.000Z","updated":"2024-04-18T03:44:47.694Z","comments":true,"path":"api/articles/内网安全-权限获取.json","keywords":null,"cover":null,"text":"","permalink":"/post/内网安全-权限获取","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"An ordinary learner","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"内网安全-基本概念","uid":"81102e6cf240e741d5c7997d1b670e8a","slug":"内网安全-基本概念","date":"2024-04-10T07:41:44.000Z","updated":"2024-04-11T13:22:59.623Z","comments":true,"path":"api/articles/内网安全-基本概念.json","keywords":null,"cover":null,"text":"内网基本概念局域网又称内网, 是指在某一区域内由多台计算机互联成的计算机组。 工作组工作组（Work Group）就像一个可以自由进入和退出的社团，方便同组的计...","permalink":"/post/内网安全-基本概念","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"An ordinary learner","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}